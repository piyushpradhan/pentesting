# Dawn-1

Author: OSPG
Difficulty: 1
Key takeaway: check .bash_history for creds
Tags: .bash_history, SMB, sudo -l
Type: Linux

# Enumeration

- portscan

```bash
Starting Nmap 7.91 ( https://nmap.org ) at 2021-10-01 13:44 EDT
Nmap scan report for 192.168.62.11
Host is up (0.00053s latency).

PORT     STATE SERVICE     VERSION
80/tcp   open  http        Apache httpd 2.4.38 ((Debian))
|_http-server-header: Apache/2.4.38 (Debian)
|_http-title: Site doesn't have a title (text/html).
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.9.5-Debian (workgroup: WORKGROUP)
3306/tcp open  mysql       MySQL 5.5.5-10.3.15-MariaDB-1
| mysql-info: 
|   Protocol: 10
|   Version: 5.5.5-10.3.15-MariaDB-1
|   Thread ID: 16
|   Capabilities flags: 63486
|   Some Capabilities: Support41Auth, InteractiveClient, ConnectWithDatabase, Speaks41ProtocolOld, SupportsTransactions, IgnoreSigpipes, SupportsLoadDataLocal, LongColumnFlag, Speaks41ProtocolNew, DontAllowDatabaseTableColumn, SupportsCompression, IgnoreSpaceBeforeParenthesis, FoundRows, ODBCClient, SupportsMultipleStatments, SupportsAuthPlugins, SupportsMultipleResults
|   Status: Autocommit
|   Salt: 6oP!QU:^K;)YcfW_Y";@
|_  Auth Plugin Name: mysql_native_password
Service Info: Host: DAWN

Host script results:
|_clock-skew: mean: 1h19m59s, deviation: 2h18m33s, median: 0s
|_nbstat: NetBIOS name: DAWN, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.9.5-Debian)
|   Computer name: dawn
|   NetBIOS computer name: DAWN\x00
|   Domain name: dawn
|   FQDN: dawn.dawn
|_  System time: 2021-10-01T13:44:59-04:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-10-01T17:44:59
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 11.87 seconds
```

- smb enumeration

```bash
S-1-22-1-1000 Unix User\dawn (Local User)
S-1-22-1-1001 Unix User\ganimedes (Local User)
```

Found management.log file from http://$ip/logs/management.log

```bash
2020/08/12 09:06:01 [31;1mCMD: UID=0    PID=979    | /bin/sh -c /home/ganimedes/phobos [0m
2020/08/12 09:06:01 [31;1mCMD: UID=0    PID=978    | /bin/sh -c chmod 777 /home/dawn/ITDEPT/web-control [0m
2020/08/12 09:06:01 [31;1mCMD: UID=0    PID=977    | /bin/sh -c chmod 777 /home/dawn/ITDEPT/product-control [0m
2020/08/12 09:06:01 [31;1mCMD: UID=1000 PID=985    | /bin/sh -c /home/dawn/ITDEPT/product-control [0m
2020/08/12 09:06:01 [31;1mCMD: UID=0    PID=984    | /bin/sh -c chmod 777 /home/dawn/ITDEPT/web-control [0m
2020/08/12 09:06:01 [31;1mCMD: UID=33   PID=982    | /bin/sh -c /home/dawn/ITDEPT/web-control [0m
2020/08/12 09:06:01 [31;1mCMD: UID=33   PID=986    | /bin/sh -c /home/dawn/ITDEPT/web-control [0m
```

# Initial Access

- we are allowed to upload files to the smb share
- the /home/dawn/ITDEPT/product-control is being executed so uploading a reverse shell script as product-control shall give us a reverse shell

# Privilege Escalation

```bash
dawn@dawn:~$ sudo -l                                                                                                                                                         
sudo -l                                                                                                                                                                      
Matching Defaults entries for dawn on dawn:                                                                                                                                  
    env_reset, mail_badpass,                                                                                                                                                 
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin                                                                                            
                                                                                                                                                                             
User dawn may run the following commands on dawn:                                                                                                                            
    (root) NOPASSWD: /usr/bin/mysql
```

- we are allowed to run mysql as root without any password
- Found the password hash for mysql in /home/dawn/.bash_history

# Notes

- /etc/shadow
    
    ```bash
    root:$6$MEZs4mfGNzwIbyei$KnVo40pUyiMtz5nGdkHdp6JIwLmekJv3s.VconYpd1/s90OAt1Mrxf6HAZ4zOxyhDrFDOGlE/JTE/xEhhPYBy/:18337:0:99999:7:::
    daemon:*:18109:0:99999:7:::
    bin:*:18109:0:99999:7:::
    sys:*:18109:0:99999:7:::
    sync:*:18109:0:99999:7:::
    games:*:18109:0:99999:7:::
    man:*:18109:0:99999:7:::
    lp:*:18109:0:99999:7:::
    mail:*:18109:0:99999:7:::
    news:*:18109:0:99999:7:::
    uucp:*:18109:0:99999:7:::
    proxy:*:18109:0:99999:7:::
    www-data:*:18109:0:99999:7:::
    backup:*:18109:0:99999:7:::
    list:*:18109:0:99999:7:::
    irc:*:18109:0:99999:7:::
    gnats:*:18109:0:99999:7:::
    nobody:*:18109:0:99999:7:::
    _apt:*:18109:0:99999:7:::
    systemd-timesync:*:18109:0:99999:7:::
    systemd-network:*:18109:0:99999:7:::
    systemd-resolve:*:18109:0:99999:7:::
    messagebus:*:18109:0:99999:7:::
    avahi-autoipd:*:18109:0:99999:7:::
    avahi:*:18109:0:99999:7:::
    saned:*:18109:0:99999:7:::
    colord:*:18109:0:99999:7:::
    hplip:*:18109:0:99999:7:::
    dawn:$6$YgbpKljlqsqFgY/w$JcxPH5fxsbkXAHFuidtT/Q7grwMa.DheRnniR1F0JcmoNDI6QMD3tu/dIyCVFtCvWOd.UNEefuuzNsYvPleIm0:18109:0:99999:7:::
    systemd-coredump:!!:18109::::::
    uuidd:*:18109:0:99999:7:::
    mysql:!:18110:0:99999:7:::
    ganimedes:$6$1nw/by6uWm1VNrX7$TrwlIjyD2MmvfYPiATkD8LqD/PiUDZP.FEdFkF8OIyUzlkYnukqnhQlmlcdfRuJZ1K0ks2CKDGXZevzsy0ljI0:18111:0:99999:7:::
    ```