# Pikaboo

Difficulty: 7
Key takeway: try fuzzing for directory traversal on unauthorized endpoints, ex: /admin../FUZZ
Tags: /admin../, LFI, Web, directory traversal, ftp, ftp log poisoning, logs, perl, php, server-status
Type: Linux

# Enumeration

- portscan

```bash
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey:
|   2048 17:e1:13:fe:66:6d:26:b6:90:68:d0:30:54:2e:e2:9f (RSA)
|   256 92:86:54:f7:cc:5a:1a:15:fe:c6:09:cc:e5:7c:0d:c3 (ECDSA)
|_  256 f4:cd:6f:3b:19:9c:cf:33:c6:6d:a5:13:6a:61:01:42 (ED25519)
80/tcp open  http    nginx 1.14.2
|_http-server-header: nginx/1.14.2
|_http-title: Pikaboo
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
```

- dir scan

```bash
/index.php            (Status: 200) [Size: 6922]
/contact.php          (Status: 200) [Size: 3180]
/images               (Status: 301) [Size: 319] [--> http://pikaboo.htb/images/]
/admin                (Status: 401) [Size: 456]
/admin.html           (Status: 403) [Size: 274]
/admin.php            (Status: 403) [Size: 274]
/admin.txt            (Status: 401) [Size: 456]
/administration       (Status: 401) [Size: 456]
/administration.html  (Status: 401) [Size: 456]
/administration.php   (Status: 401) [Size: 456]
/administration.txt   (Status: 401) [Size: 456]
/administrator.txt    (Status: 401) [Size: 456]
/administrator.html   (Status: 401) [Size: 456]
/administrator        (Status: 401) [Size: 456]
/administrator.php    (Status: 401) [Size: 456]
```

- there was an directory traversal in /admin
- was able to find the dashboard by going to /admin../server-status
- the dashboard url is vulnerable to LFI, but only certain files are allowed

```bash
ffuf -u http://pikaboo.htb/admin../admin_staging/index.php?page=FUZZ -w /usr/share/SecLists/Fuzzing/LFI/lfi.txt -fw 3272
```

- Found:

```bash
/var/log/vsftpd.log     [Status: 200, Size: 19803, Words: 3893, Lines: 414]
/var/log/wtmp           [Status: 200, Size: 169717, Words: 3286, Lines: 558]
:: Progress: [914/914] :: Job [1/1] :: 224 req/sec :: Duration: [0:00:04] :: Errors: 0 ::
```

- vsftpd.log

```bash
Thu Jul 8 17:17:47 2021 [pid 14106] CONNECT: Client "::ffff:10.10.14.6" Thu Jul 8 17:17:47 2021 [pid 14106] FTP response: Client "::ffff:10.10.14.6", "220 (vsFTPd 3.0.3)" Thu Jul 8 17:17:49 2021 [pid 14106] FTP command: Client "::ffff:10.10.14.6", "USER anonymous" Thu Jul 8 17:17:49 2021 [pid 14106] [anonymous] FTP response: Client "::ffff:10.10.14.6", "331 Please specify the password." Thu Jul 8 17:17:49 2021 [pid 14106] [anonymous] FTP command: Client "::ffff:10.10.14.6", "PASS " Thu Jul 8 17:17:49 2021 [pid 14105] [anonymous] FAIL LOGIN: Client "::ffff:10.10.14.6" Thu Jul 8 17:17:50 2021 [pid 14106] [anonymous] FTP response: Client "::ffff:10.10.14.6", "530 Login incorrect." Thu Jul 8 17:17:50 2021 [pid 14106] FTP command: Client "::ffff:10.10.14.6", "SYST" Thu Jul 8 17:17:50 2021 [pid 14106] FTP response: Client "::ffff:10.10.14.6", "530 Please login with USER and PASS." Thu Jul 8 17:18:25 2021 [pid 14106] FTP command: Client "::ffff:10.10.14.6", "QUIT" Thu Jul 8 17:18:25 2021 [pid 14106] FTP response: Client "::ffff:10.10.14.6", "221 Goodbye." Thu Jul 8 17:18:26 2021 [pid 14650] CONNECT: Client "::ffff:10.10.14.6" Thu Jul 8 17:18:26 2021 [pid 14650] FTP response: Client "::ffff:10.10.14.6", "220 (vsFTPd 3.0.3)" Thu Jul 8 17:18:29 2021 [pid 14650] FTP command: Client "::ffff:10.10.14.6", "USER 0xdf" Thu Jul 8 17:18:31 2021 [pid 14650] FTP command: Client "::ffff:10.10.14.6", "SYST" Thu Jul 8 17:18:31 2021 [pid 14650] FTP response: Client "::ffff:10.10.14.6", "530 Please login with USER and PASS." Thu Jul 8 17:18:50 2021 [pid 14650] FTP command: Client "::ffff:10.10.14.6", "QUIT" Thu Jul 8 17:18:50 2021 [pid 14650] FTP response: Client "::ffff:10.10.14.6", "221 Goodbye." Thu Jul 8 17:18:51 2021 [pid 14652] CONNECT: Client "::ffff:10.10.14.6" Thu Jul 8 17:18:51 2021 [pid 14652] FTP response: Client "::ffff:10.10.14.6", "220 (vsFTPd 3.0.3)" Thu Jul 8 17:19:05 2021 [pid 14652] FTP command: Client "::ffff:10.10.14.6", "SYST" Thu Jul 8 17:19:05 2021 [pid 14652] FTP response: Client "::ffff:10.10.14.6", "530 Please login with USER and PASS." Thu Jul 8 17:28:56 2021 [pid 19919] CONNECT: Client "::ffff:10.10.14.14" Thu Jul 8 17:28:56 2021 [pid 19919] FTP response: Client "::ffff:10.10.14.14", "220 (vsFTPd 3.0.3)" Thu Jul 8 17:30:37 2021 [pid 21009] CONNECT: Client "::ffff:10.10.14.6" Thu Jul 8 17:30:37 2021 [pid 21009] FTP response: Client "::ffff:10.10.14.6", "220 (vsFTPd 3.0.3)" Thu Jul 8 17:30:42 2021 [pid 21009] FTP command: Client "::ffff:10.10.14.6", "USER pwnmeow" Thu Jul 8 17:30:42 2021 [pid 21009] [pwnmeow] FTP response: Client "::ffff:10.10.14.6", "331 Please specify the password." Thu Jul 8 17:30:44 2021 [pid 21009] [pwnmeow] FTP command: Client "::ffff:10.10.14.6", "PASS " Thu Jul 8 17:30:44 2021 [pid 21008] [pwnmeow] FAIL LOGIN: Client "::ffff:10.10.14.6" Thu Jul 8 17:30:45 2021 [pid 21009] [pwnmeow] FTP response: Client "::ffff:10.10.14.6", "530 Login incorrect." Thu Jul 8 17:30:45 2021 [pid 21009] FTP command: Client "::ffff:10.10.14.6", "SYST" Thu Jul 8 17:30:45 2021 [pid 21009] FTP response: Client "::ffff:10.10.14.6", "530 Please login with USER and PASS." Thu Jul 8 17:30:49 2021 [pid 21009] FTP command: Client "::ffff:10.10.14.6", "QUIT" Thu Jul 8 17:30:49 2021 [pid 21009] FTP response: Client "::ffff:10.10.14.6", "221 Goodbye." Thu Jul 8 17:30:50 2021 [pid 21011] CONNECT: Client "::ffff:10.10.14.6" Thu Jul 8 17:30:50 2021 [pid 21011] FTP response: Client "::ffff:10.10.14.6", "220 (vsFTPd 3.0.3)" Thu Jul 8 17:30:53 2021 [pid 21011] FTP command: Client "::ffff:10.10.14.6", "USER pwnmeow" Thu Jul 8 17:30:53 2021 [pid 21011] [pwnmeow] FTP response: Client "::ffff:10.10.14.6", "331 Please specify the password." Thu Jul 8 17:31:01 2021 [pid 21011] [pwnmeow] FTP command: Client "::ffff:10.10.14.6", "PASS " Thu Jul 8 17:31:01 2021 [pid 21010] [pwnmeow] OK LOGIN: Client "::ffff:10.10.14.6" Thu Jul 8 17:31:01 2021 [pid 21035] [pwnmeow] FTP response: Client "::ffff:10.10.14.6", "230 Login successful." Thu Jul 8 17:31:01 2021 [pid 21035] [pwnmeow] FTP command: Client "::ffff:10.10.14.6", "SYST" Thu Jul 8 17:31:01 2021 [pid 21035] [pwnmeow] FTP response: Client "::ffff:10.10.14.6", "215 UNIX Type: L8" Thu Jul 8 17:31:03 2021 [pid 21035] [pwnmeow] FTP command: Client "::ffff:10.10.14.6", "QUIT" Thu Jul 8 17:31:03 2021 [pid 21035] [pwnmeow] FTP response: Client "::ffff:10.10.14.6", "221 Goodbye."
```

- wtmp

```bash
~~~reboot4.19.0-14-amd64X��`o5~~~runlevel4.19.0-14-amd64[��`�� �tty1tty1�[��`�� �tty1tty1LOGIN�[��`�� �tty1root^��`�[ ~~~shutdown4.19.0-14-amd64(�`F� ~~~reboot4.19.0-16-amd64N�`��5~~~runlevel4.19.0-16-amd64Q�`� �tty1tty1�Q�`�� �tty1tty1LOGIN�Q�`�� �tty1rootU�`~~~shutdown4.19.0-16-amd64��`Æ~~~reboot4.19.0-16-amd64�`��5~~~runlevel4.19.0-16-amd64�`�/�tty1tty1��`p;�tty1tty1LOGIN��`p;�tty1root�`Թ kpts/0ts/0pwnmeow10.10.14.2P�`ܲ � pts/1ts/1pwnmeow10.10.14.2��`g� � pts/1��`/��pts/1ts/1pwnmeow10.10.14.2��`ڌ �pts/1) �`;3kpts/0�"�`Z�~~~shutdown4.19.0-16-amd64�"�`�|~~~reboot4.19.0-16-amd64+0�`ٗ5~~~runlevel4.19.0-16-amd6420�`�tty1tty120�`$ tty1tty1LOGIN20�`$ tty1root�0�`���pts/0ts/0pwnmeow10.10.14.21�`�� �pts/01�` �pts/0ts/0pwnmeow10.10.14.21�`6x �pts/01�`&� �pts/0ts/0pwnmeow10.10.14.2+1�`| �pts/0,1�`���pts/0ts/0pwnmeow10.10.14.2O1�`J� Npts/1ts/1pwnmeow10.10.14.27�`�= Npts/1|K�`�@�pts/0�U�`�tty1�9�`3��+tty1tty1�+�9�`l��+tty1tty1LOGIN�+�9�`l��+tty1root�9�`��,pts/0ts/0pwnmeow10.10.14.5���`� �,pts/0劚`OLSpts/0ts/0pwnmeow10.10.14.5ꊚ`�p Spts/0)��`|+<pts/0ts/0pwnmeow10.10.14.4�f�`^] <pts/0k��`� �@pts/0ts/0pwnmeow10.10.14.6eԜ`�� �@pts/0��`�� ?Bpts/0ts/0pwnmeow10.10.14.6��`� ?Bpts/0a�`�Epts/0ts/0pwnmeow10.10.14.4.�`�� .Epts/1ts/1pwnmeow10.10.14.46.�`� .Epts/17��`� Epts/0ɕ�`s `Rpts/0ts/0pwnmeow10.10.14.28�`�) `Rpts/0��`�o�Rpts/0ts/0pwnmeow10.10.14.2��`�� uSpts/1ts/1pwnmeow10.10.14.5�G�`ۄ �Spts/2ts/2pwnmeow10.10.14.5 L�`�� �Rpts/0�L�`�� �Spts/2���`�/ uSpts/1���`�9 ~tpts/0ts/0pwnmeow10.10.14.5�Ф`" upts/1ts/1pwnmeow10.10.14.5��`uc �pts/2ts/2pwnmeow10.10.14.5���`�7 �pts/2w��`�upts/1w��`�"~tpts/0w��`��~~~shutdown4.19.0-16-amd64w��`�� ~~~reboot4.19.0-16-amd64~�`�W�tty1tty1���`�h�tty1tty1LOGIN���`�h5~~~runlevel4.19.0-16-amd64��`���tty1root��`�* ~~~shutdown4.19.0-16-amd64��`�`~~~reboot4.19.0-16-amd64W �`;�5~~~runlevel4.19.0-16-amd64Z �`B tty1tty1Z �` " tty1tty1LOGINZ �` " tty1root\ �`�# ~~~shutdown4.19.0-16-amd64� �`2�~~~reboot4.19.0-16-amd64� �`6�5~~~runlevel4.19.0-16-amd64� �`Q� tty1tty1� �`�� tty1tty1LOGIN� �`�� tty1root� �`�D~~~shutdown4.19.0-16-amd64l�`�)~~~reboot4.19.0-16-amd64v�`T�5~~~runlevel4.19.0-16-amd64z�`z�tty1tty1�z�`� �tty1tty1LOGIN�z�`� �tty1root|�`��pts/0ts/0pwnmeow10.10.14.5��`� �pts/0� �`}+~~~shutdown4.19.0-16-amd64� �` ~~~reboot4.19.0-16-amd64��`��5~~~runlevel4.19.0-16-amd64��`�i�tty1tty1���`n�tty1tty1LOGIN���`n�tty1root��`߸~~~shutdown4.19.0-16-amd640�`_q~~~reboot4.19.0-16-amd64��`��5~~~runlevel4.19.0-16-amd64��`'m �tty1tty1���`�v �tty1tty1LOGIN���`�v �tty1root��`!n~~~shutdown4.19.0-16-amd64��`�� ~~~reboot4.19.0-16-amd64$�`��5~~~runlevel4.19.0-16-amd64(�`�L�tty1tty1�(�`�W�tty1tty1LOGIN�(�`�W�tty1root*�`lm~~~shutdown4.19.0-16-amd643�`��~~~reboot4.19.0-16-amd649�`G�5~~~runlevel4.19.0-16-amd64<�`� �tty1tty1�<�`p' �tty1tty1LOGIN�<�`p' �tty1rootA�`�pts/0ts/0pwnmeow10.10.14.5E�`C� 3pts/1ts/1pwnmeow10.10.14.5K�`�� pts/0a+�`��3pts/1c+�`� pts/0ts/0pwnmeow10.10.14.3��`;� Bpts/1ts/1pwnmeow10.10.14.3���`�`  pts/0j�`[Bpts/1j�`Y ~~~shutdown4.19.0-16-amd64m�`�%~~~reboot4.19.0-16-amd64w�`.i5~~~runlevel4.19.0-16-amd64|�`[�tty1tty1|�`��tty1tty1LOGIN|�`���pts/0ts/0pwnmeow10.10.14.3��`�P �pts/0��`��tty1tty1��`�c~~~shutdown4.19.0-16-amd64��`�~~~reboot4.19.0-16-amd64��`�5~~~runlevel4.19.0-16-amd64��`� tty1tty1��`�� tty1tty1LOGIN��`�� *pts/0ts/0pwnmeow10.10.14.3��`S� *pts/0��`L tty1tty1��`�~~~shutdown4.19.0-16-amd64��`"~~~reboot4.19.0-16-amd64��`"b5~~~runlevel4.19.0-16-amd64��`� �tty1tty1���`� �tty1tty1LOGIN���`� pts/0ts/0pwnmeow10.10.14.3��`̣ pts/0K�`<��tty1tty1�K�`]~~~shutdown4.19.0-16-amd64M�`�y~~~reboot4.19.0-16-amd64W�`x�5~~~runlevel4.19.0-16-amd64Z�`9E�tty1tty1�Z�`&� �tty1tty1LOGIN�Z�`&� pts/0ts/0pwnmeow10.10.14.3^�`�� pts/03%�`c��tty1tty1�3%�`�!~~~shutdown4.19.0-16-amd643%�`~~~~reboot4.19.0-16-amd64>%�`a=5~~~runlevel4.19.0-16-amd64A%�`z�tty1tty1�B%�`5�tty1tty1LOGIN�B%�`5G<pts/0ts/0pwnmeow10.10.14.2/�`�� G<pts/0&/�`��LJpts/0ts/0pwnmeow10.10.14.391�`�� LJpts/0O1�`���Kpts/0ts/0root10.10.14.3T1�`h �Kpts/0T1�`V� �Npts/0ts/0root10.10.14.3�1�`a[ �)pts/1ts/1pwnmeow10.10.14.2!>�`] �Npts/0�a�`���pts/0ts/0root10.10.14.3�q�`?b �pts/0�y�`&�)pts/1���`-��0pts/0ts/0root10.10.14.34��`�� �Apts/1ts/1root10.10.14.3��`�� �0pts/0���` ��Apts/1���`d�Jpts/0ts/0root10.10.14.3�-�`� �^pts/1ts/1root10.10.14.3$1�`x$ �^pts/1�L�`B�tty1tty1��L�`'�~~~shutdown4.19.0-16-amd64�L�`~~~reboot4.19.0-16-amd64M�`�M 5~~~runlevel4.19.0-16-amd64 M�` =tty1tty1 M�`�Itty1tty1LOGIN M�`�I�pts/0ts/0root10.10.14.3M�`� �pts/0�[�`�|$gpts/0ts/0root10.10.14.3xq�`( -gpts/1ts/1root10.10.14.3}q�` 'gpts/1���`7Igpts/0���`�!�9pts/0ts/0root10.10.14.2ԑ�`�L �9pts/0_��`k P\pts/0ts/0root10.10.14.2�`�o �[pts/0�ë`գP pts/0ts/0root10.10.14.2ӫ`� > pts/0�ݫ`ޖ�epts/0ts/0root10.10.14.2��`� �epts/0h�`�} }jpts/0ts/0root10.10.14.2���`�` 8Mpts/1ts/1pwnmeow10.10.14.2���`�, kjpts/0���`�8Mpts/1���`ftty1tty1���`�~~~shutdown4.19.0-16-amd64���`M� ~~~reboot4.19.0-16-amd648!�`[�5~~~runlevel4.19.0-16-amd64?!�`�� tty1tty1B!�`8rtty1tty1LOGINB!�`8r/pts/0ts/0root10.10.14.2F!�`� �pts/1ts/1pwnmeow10.10.14.2�#�`�# �pts/1i&�`�� pts/0w&�`�� )pts/0ts/0root10.10.14.3�N�`� pts/0X�`zn,pts/0ts/0root10.10.14.3rx�`= pts/0䛰`"��epts/0ts/0root10.10.14.2��`m$ �epts/0���`|Hrpts/0ts/0root10.10.14.2�`Ŏ �pts/0ץ�`8806pts/0ts/0root10.10.14.3԰`N� 6pts/0԰`�g tty1tty1԰`d ~~~shutdown4.19.0-16-amd64԰`�#~~~reboot4.19.0-16-amd64�԰`� 5~~~runlevel4.19.0-16-amd64�԰`�� �tty1tty1��԰`  �tty1tty1LOGIN��԰`  :6pts/0ts/0root10.10.14.3[�`�C �tty1tty1��`�~~~shutdown4.19.0-16-amd64�`~~~reboot4.19.0-16-amd64��`�15~~~runlevel4.19.0-16-amd64��`��tty1tty1���`B�tty1tty1LOGIN���`B�tty1root��` *6pts/0ts/0pwnmeow10.10.14.2��`�{ 6pts/0^�`�Nr>pts/0ts/0pwnmeow10.10.14.2i�`<� r>pts/0��`���Bpts/0ts/0pwnmeow10.10.14.2��`u� ~~~reboot4.19.0-16-amd64�`275~~~runlevel4.19.0-16-amd64"�`'�tty1tty1�"�`�%�tty1tty1LOGIN�"�`�%Mpts/0ts/0pwnmeow10.10.14.29�`� Mpts/0�5�`hGf^pts/0ts/0root10.10.14.3���`�Y T^pts/0���`No^pts/0ts/0root10.10.14.3���`@� �tty1tty1����`�� ~~~shutdown4.19.0-16-amd64���`�J ~~~reboot4.19.0-16-amd64�b�`��5~~~runlevel4.19.0-16-amd64�b�`��tty1tty1�b�`��tty1tty1LOGIN�b�`��tty1root�b�`�=~~~shutdown4.19.0-16-amd64 s�`@�~~~reboot4.19.0-16-amd64s�`J�5~~~runlevel4.19.0-16-amd64s�`ltty1tty1s�`�tty1tty1LOGINs�`�tty1root!s�`A -mpts/0ts/0root10.10.14.3�~�`�l ~~~shutdown4.19.0-16-amd64?��`f�~~~reboot4.19.0-16-amd64D��`J��tty1tty1�J��`���tty1tty1LOGIN�J��`��5~~~runlevel4.19.0-16-amd64J��`8W�tty1root���`z� ~~~shutdown4.19.0-16-amd64��`�~~~reboot4.19.0-17-amd64U��` ��tty1tty1�\��`9*�tty1tty1LOGIN�\��`9*5~~~runlevel4.19.0-17-amd64\��`�� �tty1root���`x�~~~shutdown4.19.0-17-amd64&��`�X~~~reboot4.19.0-17-amd644F�`#�5~~~runlevel4.19.0-17-amd648F�`ڶtty1tty19F�`/$ tty1tty1LOGIN9F�`/$ tty1tty1�F�`5� �tty1tty1��F�`x!�tty1tty1LOGIN��F�`x!�tty1root�F�`��bpts/0ts/0root10.10.14.4�m�` ~~~shutdown4.19.0-17-amd64\��`n> ~~~reboot4.19.0-17-amd64,��`�u5~~~runlevel4.19.0-17-amd64/��`T�tty1tty1�/��`P`�tty1tty1LOGIN�/��`P`�tty1root?��`�f~~~shutdown4.19.0-17-amd64n��`1< ~~~reboot4.19.0-17-amd64��`��5~~~runlevel4.19.0-17-amd64��`�6�tty1tty1���`�C�tty1tty1LOGIN���`�C�tty1root#��`�r~~~shutdown4.19.0-17-amd64e��`0M ~~~reboot4.19.0-17-amd64p��`�Q5~~~runlevel4.19.0-17-amd64s��`�p�tty1tty1�s��`ށ�tty1tty1LOGIN�s��`ށ�tty1root���`_~~~shutdown4.19.0-17-amd64���`:�~~~reboot4.19.0-17-amd64&�`� 5~~~runlevel4.19.0-17-amd64)�`�� �tty1tty1�)�`� �tty1tty1LOGIN�)�`� �tty1rootF�`�f~~~shutdown4.19.0-17-amd64\�`l~~~~reboot4.19.0-17-amd64.�`��5~~~runlevel4.19.0-17-amd642�`mP�tty1tty1�3�`0�tty1tty1LOGIN�3�`0�tty1tty1�� �`�>dtty1tty1d� �`aedtty1tty1LOGINd� �`aedtty1root� �`�Y~~~shutdown4.19.0-17-amd64~(�`5�~~~reboot4.19.0-17-amd64r)�`��5~~~runlevel4.19.0-17-amd64v)�`9U �tty1tty1�v)�`�b �tty1tty1LOGIN�v)�`�b �tty1root�)�`w~~~shutdown4.19.0-17-amd64�1�`��~~~reboot4.19.0-17-amd64*C�`�5~~~runlevel4.19.0-17-amd64-C�`� �tty1tty1�-C�`� �tty1tty1LOGIN�-C�`� �tty1root�C�`c�~~~shutdown4.19.0-17-amd64�C�`�~~~reboot4.19.0-17-amd64D�`�y 5~~~runlevel4.19.0-17-amd64"D�`!�tty1tty1#D�`*�tty1tty1LOGIN#D�`*�tty1root�D�`�| 4pts/0ts/0root10.10.14.6�W�`�� ~~~shutdown4.19.0-17-amd64�X�`��~~~reboot4.19.0-17-amd64TQ�`�� 5~~~runlevel4.19.0-17-amd64XQ�`S@�tty1tty1�YQ�`[+�tty1tty1LOGIN�YQ�`[+�tty1root|Q�`� ~~~shutdown4.19.0-17-amd64 S�`��~~~reboot4.19.0-17-amd64M��`�5~~~runlevel4.19.0-17-amd64P��`8�tty1tty1�R��`}�tty1tty1LOGIN�R��`}/pts/0ts/0root10.10.14.6���`i� �tty1tty1�V��`gV~~~shutdown4.19.0-17-amd64V��`h�~~~reboot4.19.0-17-amd64���`U5~~~runlevel4.19.0-17-amd64���`���tty1tty1����`p��tty1tty1LOGIN����`p�dpts/0ts/0root10.10.14.6���`� �tty1tty1���`�4~~~shutdown4.19.0-17-amd64��`��~~~reboot4.19.0-17-amd64#1�`s��tty1tty1�+1�`G'�tty1tty1LOGIN�+1�`G'5~~~runlevel4.19.0-17-amd64+1�`o��pts/0ts/0root10.10.14.133�`\�  �tty1tty1�+4�` ~~~shutdown4.19.0-17-amd64+4�`֣~~~reboot4.19.0-17-amd64e��`,H5~~~runlevel4.19.0-17-amd64m��`� Ztty1tty1Zm��`Ztty1tty1LOGINZm��`K pts/0ts/0root10.10.14.11!��`�� Ztty1tty1Z���`+K ~~~shutdown4.19.0-17-amd64���`ߓ~~~reboot4.19.0-17-amd64���`��5~~~runlevel4.19.0-17-amd64���`7��tty1tty1����`cy �tty1tty1LOGIN����`cy �tty1root���`�� ~~~shutdown4.19.0-17-amd64���`6~~~reboot4.19.0-17-amd64���`�{5~~~runlevel4.19.0-17-amd64���`��tty1tty1����`�tty1tty1LOGIN����`�tty1rootc��`��~~~shutdown4.19.0-17-amd64���`Q�~~~reboot4.19.0-17-amd64���`5�tty1tty1����`���tty1tty1LOGIN����`��5~~~runlevel4.19.0-17-amd64���`, �tty1tty1�S��`�~~~shutdown4.19.0-17-amd64S��`�~~~reboot4.19.0-17-amd64XX�a��5~~~runlevel4.19.0-17-amd64\X�aK7�tty1tty1�]X�a��tty1tty1LOGIN�]X�a�
```

# Initial Access

- use ftp log poisoning as described here

[Get Reverse Shell Through Log Poisoning with the Vulnerability of - LFI ( LOCAL FILE INCLUSION )](https://dheerajdeshmukh.medium.com/get-reverse-shell-through-log-poisoning-with-the-vulnerability-of-lfi-local-file-inclusion-e504e2d41f69)

obtained shell as www-data

# Privilege Escalation

- Found this inside /opt/pokeapi/config/settings.py

```bash
"ldap": {": "ldap:///",
        "ENGINE": "ldapdb.backends.ldap",s settings.py
        "NAME": "ldap:///",
        "USER": "cn=binduser,ou=users,dc=pikaboo,dc=htb",
        "PASSWORD": "J~42%W?PFHl]g",
    },
```

- can be used for enumerating ldap using `ldapsearch`

```bash
www-data@pikaboo:/opt/pokeapi/config$ ldapsearch -x -h 127.0.0.1 -LLL -D 'cn=binduser,ou=users,dc=pikaboo,dc=htb' -w J~42%W?PFHl]g -b 'dc=ftp,dc=pikaboo,dc=htb'
dn: dc=ftp,dc=pikaboo,dc=htb
objectClass: domain
dc: ftp

dn: ou=users,dc=ftp,dc=pikaboo,dc=htb
objectClass: organizationalUnit
objectClass: top
ou: users

dn: ou=groups,dc=ftp,dc=pikaboo,dc=htb
objectClass: organizationalUnit
objectClass: top
ou: groups

dn: uid=pwnmeow,ou=users,dc=ftp,dc=pikaboo,dc=htb
objectClass: inetOrgPerson
objectClass: posixAccount
objectClass: shadowAccount
uid: pwnmeow
cn: Pwn
sn: Meow
loginShell: /bin/bash
uidNumber: 10000
gidNumber: 10000
homeDirectory: /home/pwnmeow
userPassword:: X0cwdFQ0X0M0dGNIXyczbV80bEwhXw==
```

- found the creds for pwnmeow's ftp
- checked the cron jobs there was a script running as root
- /usr/local/bin/csvupdate_cron

```bash
#!/bin/bash

for d in /srv/ftp/*
do
  cd $d
  /usr/local/bin/csvupdate $(basename $d) *csv
  /usr/bin/rm -rf *
done
```

- /usr/local/bin/csvupdate

```perl
#!/usr/bin/perl

##################################################################
# Script for upgrading PokeAPI CSV files with FTP-uploaded data. #
#                                                                #
# Usage:                                                         #
# ./csvupdate <type> <file(s)>                                   #
#                                                                #
# Arguments:                                                     #
# - type: PokeAPI CSV file type                                  #
#         (must have the correct number of fields)               #
# - file(s): list of files containing CSV data                   #
##################################################################

use strict;
use warnings;
use Text::CSV;

my $csv_dir = "/opt/pokeapi/data/v2/csv";

my %csv_fields = (
  'abilities' => 4,
  'ability_changelog' => 3,
  'ability_changelog_prose' => 3,
  'ability_flavor_text' => 4,
  'ability_names' => 3,
  'ability_prose' => 4,
  'berries' => 10,
  'berry_firmness' => 2,
  'berry_firmness_names' => 3,
  'berry_flavors' => 3,
  'characteristics' => 3,
  'characteristic_text' => 3,
  'conquest_episode_names' => 3,
  'conquest_episodes' => 2,
  'conquest_episode_warriors' => 2,
  'conquest_kingdom_names' => 3,
  'conquest_kingdoms' => 3,
  'conquest_max_links' => 3,
  'conquest_move_data' => 7,
  'conquest_move_displacement_prose' => 5,
  'conquest_move_displacements' => 3,
  'conquest_move_effect_prose' => 4,
  'conquest_move_effects' => 1,
  'conquest_move_range_prose' => 4,
  'conquest_move_ranges' => 3,
  'conquest_pokemon_abilities' => 3,
  'conquest_pokemon_evolution' => 8,
  'conquest_pokemon_moves' => 2,
  'conquest_pokemon_stats' => 3,
  'conquest_stat_names' => 3,
  'conquest_stats' => 3,
  'conquest_transformation_pokemon' => 2,
  'conquest_transformation_warriors' => 2,
  'conquest_warrior_archetypes' => 2,
  'conquest_warrior_names' => 3,
  'conquest_warrior_ranks' => 4,
  'conquest_warrior_rank_stat_map' => 3,
  'conquest_warriors' => 4,
  'conquest_warrior_skill_names' => 3,
  'conquest_warrior_skills' => 2,
  'conquest_warrior_specialties' => 3,
  'conquest_warrior_stat_names' => 3,
  'conquest_warrior_stats' => 2,
  'conquest_warrior_transformation' => 10,
  'contest_combos' => 2,
  'contest_effect_prose' => 4,
  'contest_effects' => 3,
  'contest_type_names' => 5,
  'contest_types' => 2,
  'egg_group_prose' => 3,
  'egg_groups' => 2,
  'encounter_condition_prose' => 3,
  'encounter_conditions' => 2,
  'encounter_condition_value_map' => 2,
  'encounter_condition_value_prose' => 3,
  'encounter_condition_values' => 4,
  'encounter_method_prose' => 3,
  'encounter_methods' => 3,
  'encounters' => 7,
  'encounter_slots' => 5,
  'evolution_chains' => 2,
  'evolution_trigger_prose' => 3,
  'evolution_triggers' => 2,
  'experience' => 3,
  'genders' => 2,
  'generation_names' => 3,
  'generations' => 3,
  'growth_rate_prose' => 3,
  'growth_rates' => 3,
  'item_categories' => 3,
  'item_category_prose' => 3,
  'item_flag_map' => 2,
  'item_flag_prose' => 4,
  'item_flags' => 2,
  'item_flavor_summaries' => 3,
  'item_flavor_text' => 4,
  'item_fling_effect_prose' => 3,
  'item_fling_effects' => 2,
  'item_game_indices' => 3,
  'item_names' => 3,
  'item_pocket_names' => 3,
  'item_pockets' => 2,
  'item_prose' => 4,
  'items' => 6,
  'language_names' => 3,
  'languages' => 6,
  'location_area_encounter_rates' => 4,
  'location_area_prose' => 3,
  'location_areas' => 4,
  'location_game_indices' => 3,
  'location_names' => 4,
  'locations' => 3,
  'machines' => 4,
  'move_battle_style_prose' => 3,
  'move_battle_styles' => 2,
  'move_changelog' => 10,
  'move_damage_classes' => 2,
  'move_damage_class_prose' => 4,
  'move_effect_changelog' => 3,
  'move_effect_changelog_prose' => 3,
  'move_effect_prose' => 4,
  'move_effects' => 1,
  'move_flag_map' => 2,
  'move_flag_prose' => 4,
  'move_flags' => 2,
  'move_flavor_summaries' => 3,
  'move_flavor_text' => 4,
  'move_meta_ailment_names' => 3,
  'move_meta_ailments' => 2,
  'move_meta_categories' => 2,
  'move_meta_category_prose' => 3,
  'move_meta' => 13,
  'move_meta_stat_changes' => 3,
  'move_names' => 3,
  'moves' => 15,
  'move_target_prose' => 4,
  'move_targets' => 2,
  'nature_battle_style_preferences' => 4,
  'nature_names' => 3,
  'nature_pokeathlon_stats' => 3,
  'natures' => 7,
  'pal_park_area_names' => 3,
  'pal_park_areas' => 2,
  'pal_park' => 4,
  'pokeathlon_stat_names' => 3,
  'pokeathlon_stats' => 2,
  'pokedexes' => 4,
  'pokedex_prose' => 4,
  'pokedex_version_groups' => 2,
  'pokemon_abilities' => 4,
  'pokemon_color_names' => 3,
  'pokemon_colors' => 2,
  'pokemon' => 8,
  'pokemon_dex_numbers' => 3,
  'pokemon_egg_groups' => 2,
  'pokemon_evolution' => 20,
  'pokemon_form_generations' => 3,
  'pokemon_form_names' => 4,
  'pokemon_form_pokeathlon_stats' => 5,
  'pokemon_forms' => 10,
  'pokemon_form_types' => 3,
  'pokemon_game_indices' => 3,
  'pokemon_habitat_names' => 3,
  'pokemon_habitats' => 2,
  'pokemon_items' => 4,
  'pokemon_move_method_prose' => 4,
  'pokemon_move_methods' => 2,
  'pokemon_moves' => 6,
  'pokemon_shape_prose' => 5,
  'pokemon_shapes' => 2,
  'pokemon_species' => 20,
  'pokemon_species_flavor_summaries' => 3,
  'pokemon_species_flavor_text' => 4,
  'pokemon_species_names' => 4,
  'pokemon_species_prose' => 3,
  'pokemon_stats' => 4,
  'pokemon_types' => 3,
  'pokemon_types_past' => 4,
  'region_names' => 3,
  'regions' => 2,
  'stat_names' => 3,
  'stats' => 5,
  'super_contest_combos' => 2,
  'super_contest_effect_prose' => 3,
  'super_contest_effects' => 2,
  'type_efficacy' => 3,
  'type_game_indices' => 3,
  'type_names' => 3,
  'types' => 4,
  'version_group_pokemon_move_methods' => 2,
  'version_group_regions' => 2,
  'version_groups' => 4,
  'version_names' => 3,
  'versions' => 3
);

if($#ARGV < 1)
{
  die "Usage: $0 <type> <file(s)>\n";
}

my $type = $ARGV[0];
if(!exists $csv_fields{$type})
{
  die "Unrecognised CSV data type: $type.\n";
}

my $csv = Text::CSV->new({ sep_char => ',' });

my $fname = "${csv_dir}/${type}.csv";
open(my $fh, ">>", $fname) or die "Unable to open CSV target file.\n";

shift;
for(<>)
{
  chomp;
  if($csv->parse($_))
  {
    my @fields = $csv->fields();
    if(@fields != $csv_fields{$type})
    {
      warn "Incorrect number of fields: '$_'\n";
      next;
    }
    print $fh "$_\n";
  }
}

close($fh);
```

## Notes

-