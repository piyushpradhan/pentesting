# Writer

# Enumeration

portscan 

```bash
PORT    STATE SERVICE     VERSION
22/tcp  open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 98:20:b9:d0:52:1f:4e:10:3a:4a:93:7e:50:bc:b8:7d (RSA)
|   256 10:04:79:7a:29:74:db:28:f9:ff:af:68:df:f1:3f:34 (ECDSA)
|_  256 77:c4:86:9a:9f:33:4f:da:71:20:2c:e1:51:10:7e:8d (ED25519)
80/tcp  open  http        Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Story Bank | Writer.HTB
139/tcp open  netbios-ssn Samba smbd 4.6.2
445/tcp open  netbios-ssn Samba smbd 4.6.2
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_nbstat: NetBIOS name: WRITER, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-10-28T17:01:52
|_  start_date: N/A
```

- dir scan

```bash
/administrative
```

- smb enumeration

```bash
S-1-22-1-1000 Unix User\kyle (Local User)
S-1-22-1-1001 Unix User\john (Local User)
```

- used sqli to log in as admin

```bash
username: ' or 1=1;-- 
password: password
```

# Initial Access

- upload a php script while adding a story
    - intercept the POST request using burp and modify the POST request as follow, to exploit command injection
    
    ![Untitled](Writer%20456ac964977b410d97e06f1a5d746c2c/Untitled.png)
    

# Privilege Escalation

- found the path to the databse config file from [settings.py](http://settings.py) of a django app
- creds : djangouser:DjangoSuperPassword

```bash
+----+------------------------------------------------------------------------------------------+------------+--------------+----------+------------+-----------+-----------------+----------+-----------+----------------------------+
| id | password                                                                                 | last_login | is_superuser | username | first_name | last_name | email           | is_staff | is_active | date_joined                |
+----+------------------------------------------------------------------------------------------+------------+--------------+----------+------------+-----------+-----------------+----------+-----------+----------------------------+
|  1 | pbkdf2_sha256$260000$wJO3ztk0fOlcbssnS1wJPD$bbTyCB8dYWMGYlz4dSArozTY7wcZCS7DV6l5dpuXM4A= | NULL       |            1 | kyle     |            |           | kyle@writer.htb |
   1 |         1 | 2021-05-19 12:41:37.168368 |
|  2 | pbkdf2_sha256$260000$Zedr2OszDiJtq5WQa4G32y$fB2ZcRcVpdm9Kqhm9asHpoBjpfFAnW6GIsUy0vePvJw= | NULL       |            1 | mamad    |            |           | mamad@mamad.com |
   1 |         1 | 2021-11-05 15:34:42.847445 |
+----+------------------------------------------------------------------------------------------+------------+--------------+----------+------------+-----------+-----------------+----------+-----------+----------------------------+
```

- cracked the password for kyle → pbkdf2_sha256$260000$wJO3ztk0fOlcbssnS1wJPD$bbTyCB8dYWMGYlz4dSArozTY7wcZCS7DV6l5dpuXM4A=:marcoantonio
- SMTP server is running on port 25
    - check /etc/postfix
    - /etc/postfix/disclaimer script automatically adds a disclaimer to outgoing mails
    - which means every time we send a mail this script will be executed, we can use this to get a reverse shell
- got a reverse shell as john
- ps aux reveals that root is running apt-get update
    - pre/post-invoke hooks can be used to execute certain command right before apt-get update starts as root
    - we can use it to get a reverse shell as root
        - create a new file in /etc/apt/apt.conf.d
            
            ```bash
            apt::Update::Pre-Invoke {"reverse shell bash script"};
            ```
            
            wait for apt-get update to run and we get a reverse shell
            

## Notes

- if port 25 is active → check /etc/postfix
    - some scripts are being run when outgoing mails are sent
- if apt-get update is running → we can use apt::Update::Pre-Invoke to run our own commands to run right before apt-get update with escalated privileges IF /etc/apt/apt.conf.d directory is writable