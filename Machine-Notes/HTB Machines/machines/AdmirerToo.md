**# Enumeration
- Portscan 
```bash
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey: 
|   2048 99:33:47:e6:5f:1f:2e:fd:45:a4:ee:6b:78:fb:c0:e4 (RSA)
|   256 4b:28:53:64:92:57:84:77:5f:8d:bf:af:d5:22:e1:10 (ECDSA)
|_  256 71:ee:8e:e5:98:ab:08:43:3b:86:29:57:23:26:e9:10 (ED25519)
80/tcp open  http    Apache httpd 2.4.38 ((Debian))
|_http-title: Admirer
|_http-server-header: Apache/2.4.38 (Debian)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
16010/tcp filtered unknown
16030/tcp filtered unknown
```
- Dirscan 
```bash
301        9l       29w      359c http://admirer.htb/img
200      268l      658w        0c http://admirer.htb/index.php
301        9l       29w      359c http://admirer.htb/css
301        9l       29w      362c http://admirer.htb/manual
301        9l       29w      369c http://admirer.htb/manual/images
301        9l       29w      365c http://admirer.htb/manual/en
301        9l       29w      369c http://admirer.htb/manual/en/faq
301        9l       29w      365c http://admirer.htb/manual/de
301        9l       29w      365c http://admirer.htb/manual/fr
301        9l       29w      369c http://admirer.htb/manual/fr/faq
301        9l       29w      358c http://admirer.htb/js
301        9l       29w      374c http://admirer.htb/manual/en/programs
301        9l       29w      374c http://admirer.htb/manual/de/programs
301        9l       29w      371c http://admirer.htb/manual/en/howto
301        9l       29w      365c http://admirer.htb/manual/tr
301        9l       29w      371c http://admirer.htb/manual/fr/howto
301        9l       29w      369c http://admirer.htb/manual/tr/faq
301        9l       29w      370c http://admirer.htb/manual/tr/misc
301        9l       29w      371c http://admirer.htb/manual/de/howto
301        9l       29w      375c http://admirer.htb/manual/en/developer
200      598l     3336w    37762c http://admirer.htb/manual/en/sections.html
301        9l       29w      368c http://admirer.htb/manual/style
```
- Generally port 16010-16030 are used by **Motorhead servers** or **Apache HBase**
- Uses LightBox, which is a wordpress plugin, so it probably is a wordpress site 
![](Pasted%20image%2020220129013136.png)
- found another virtual host, maybe ? 
![](Pasted%20image%2020220129025141.png)
- found another virtual host
```bash
ffuf -u "http://admirer-gallery.htb" -H 'Host: FUZZ.admirer-gallery.htb' -w /usr/share/amass/wordlists/subdomains-top1mil-110000.txt -fw 4572

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.3.1 Kali Exclusive <3
________________________________________________

 :: Method           : GET
 :: URL              : http://admirer-gallery.htb
 :: Wordlist         : FUZZ: /usr/share/amass/wordlists/subdomains-top1mil-110000.txt
 :: Header           : Host: FUZZ.admirer-gallery.htb
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
 :: Filter           : Response words: 4572
________________________________________________

db                      [Status: 200, Size: 2569, Words: 113, Lines: 63]
web5433                 [Status: 200, Size: 0, Words: 1, Lines: 1]
```
- ![](Pasted%20image%2020220129022719.png)
- Portscanning agains reveals another port 
```bash
PORT      STATE    SERVICE        VERSION
22/tcp    open     ssh            OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey:
|   2048 99:33:47:e6:5f:1f:2e:fd:45:a4:ee:6b:78:fb:c0:e4 (RSA)
|   256 4b:28:53:64:92:57:84:77:5f:8d:bf:af:d5:22:e1:10 (ECDSA)
|_  256 71:ee:8e:e5:98:ab:08:43:3b:86:29:57:23:26:e9:10 (ED25519)
80/tcp    open     http           Apache httpd 2.4.38 ((Debian))
|_http-title: Admirer
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.38 (Debian)
4242/tcp  filtered vrml-multi-use
16010/tcp filtered unknown
16030/tcp filtered unknown
```


# Initial Foothold
- Found db details
![](Pasted%20image%2020220129025920.png)
- using adminer 4.7.8 / 4.8.1
![](Pasted%20image%2020220129030123.png)
- admirer database only has 1 table `gallery`
![](Pasted%20image%2020220129030653.png)
- Or maybe we're just not allowed to view other tables
- Found creds for this low privilege account (admirer_ro)
![](Pasted%20image%2020220129031027.png)
- `admirer_ro:1w4nn4b3adm1r3d2!`
- Trying to login to ssh using these creds - that didn't work 
- Found a file import section, trying to upload a reverse shell 
![](Pasted%20image%2020220129032658.png)
![](Pasted%20image%2020220129035030.png)
- the PoC is available as a PDF on github in a PR or commit
- dirscan on db.admirer-gallery.htb revealed
![](Pasted%20image%2020220129035625.png)
- oneclick-login.php is probably the service responsible for logging us into the db server
![](Pasted%20image%2020220129035456.png)
- change the auth_driver in the login request using burp
![](Pasted%20image%2020220129041429.png)
- Now there are two options here
![](Pasted%20image%2020220129041520.png)
- still no hits on the server we deployed with `redirect.py`
- let's change the server this time to our IP
![](Pasted%20image%2020220129042027.png)
- Got a couple of hits this time while authenticating
- so earlier it was sending the request to 'its' localhost, our target machine
- that didn't work either
- Actually, in the first POST request change the auth_driver to 'elastic' and in the next request change the server in the URL to our machine's IP
![](Pasted%20image%2020220129042421.png)

- Also for some reason the requests are only hitting plugin.php
I've been doing it wrong this whole time, should have looked at the script more closely.
	-  the script simply redirects the requests coming to our server to another URL that we provide
	-  So, if I provide the url of 10.10.11.137 I get the contents of index.html
	-  If I try to send requests to those 4242, 16010 and 16030 ports maybe I'll get something.
	- 4242 seems interesting, it says it has hosted a OpenTSDB server which has an RCE Exploit, other ports just timeout
![](Pasted%20image%2020220129195340.png)
- I try to set the redirect_url to http://10.10.11.137:4242 and I got a response 
```HTML
<!DOCTYPE html><html><head><meta http-equiv=content-type content="text/html;charset=utf-8"><title>OpenTSDB</title> <style><!-- body{font-family:arial,sans-serif;margin-left:2em}A.l:link{color:#6f6f6f}A.u:link{color:green}.fwf{font-family:monospace;white-space:pre-wrap}//--></style><script type=text/javascript language=javascript src=s/queryui.nocache.js></script></head> <body text=#000000 bgcolor=#ffffff><table border=0 cellpadding=2 cellspacing=0 width=100%><tr><td rowspan=3 width=1% nowrap><img src=s/opentsdb_header.jpg><td>&nbsp;</td></tr><tr><td><font color=#507e9b><b></b></td></tr><tr><td>&nbsp;</td></tr></table><div id=queryuimain></div><noscript>You must have JavaScript enabled.</noscript><iframe src=javascript:'' id=__gwt_historyFrame tabIndex=-1 style=position:absolute;width:0;height:0;border:0></iframe><table width=100% cellpadding=0 cellspacing=0><tr><td class=subg><img alt="" width=1 height=6></td></tr></table></body></html>
``` 
- instead of redirecting to 10.10.11.137, I tried to 127.0.0.1 because that'll allow it to access the server internally... which I should've done in the first place.

# Privilege Escalation

## Notes
