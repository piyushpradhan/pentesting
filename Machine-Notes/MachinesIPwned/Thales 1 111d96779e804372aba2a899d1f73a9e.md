# Thales 1

Author: Vulnhub
Difficulty: 2
Key takeaway: Use pspy to monitor processes 
Tags: /manager, id_rsa, pspy, ssh, tomcat, war
Type: Linux

# Enumeration

- portscan

```bash
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 8c:19:ab:91:72:a5:71:d8:6d:75:1d:8f:65:df:e1:32 (RSA)
|   256 90:6e:a0:ee:d5:29:6c:b9:7b:05:db:c6:82:5c:19:bf (ECDSA)
|_  256 54:4d:7b:e8:f9:7f:21:34:3e:ed:0f:d9:fe:93:bf:00 (ED25519)
8080/tcp open  http    Apache Tomcat 9.0.52
|_http-favicon: Apache Tomcat
|_http-title: Apache Tomcat/9.0.52
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

- dir scan

```kotlin
/manager # required authentication 
```

- used msfconsole's scanner/http/tomcat_mgr_login module to bruteforce common username and passwords
- Found creds → tomcat:role1

# Initial Access

- used metasploit's tomcat_mgr_upload module to get a meterpreter shell
- found id_rsa keys inside /home/thales/.ssh
- Used those to crack thales' password

```kotlin
python2 ssh2john id_rsa > id_rsa.hash 
john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.hash
```

# Privilege Escalation

- /home/thales/notes.txt → [backup.sh](http://backup.sh) script was being run as root and was EDITABLE!
- added a reverse shell script at the end and obtained a root shell

# Notes

-