# Privilege Escalation

## Windows Privilege Escalation Checklist

### System Info

- [ ]  Obtain system information

    ```python
    systeminfo # detailed information
    systeminfo | findstr /B /C:"OS Name" /C:"OS Version" # Get only that information
    wmic qfe get Caption,Description,HotFixID,InstalledOn # Security patches and updates
    wmic os get osarchitecture # check for system architecture

    [System.Environment]::OSVersion.Version #Current OS version
    Get-WmiObject -query 'select * from win32_quickfixengineering' | foreach {$_.hotfixid} #List all patches
    Get-Hotfix -description "Security update" #List only "Security Update" patches
    ```

- [ ]  Search for kernel exploits

    **On the system**

    - *post/windows/gather/enum_patches*
    - *post/multi/recon/local_exploit_suggester*
    - *[watson](https://github.com/rasta-mouse/Watson)*
    - *[winpeas](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite) (Winpeas has watson embedded)*

    **Locally with system infromation**

    - [https://github.com/AonCyberLabs/Windows-Exploit-Suggester](https://github.com/AonCyberLabs/Windows-Exploit-Suggester)
    - [https://github.com/bitsadmin/wesng](https://github.com/bitsadmin/wesng)

    **Github repos of exploits:**

    - [https://github.com/nomi-sec/PoC-in-GitHub](https://github.com/nomi-sec/PoC-in-GitHub)
    - [https://github.com/abatchy17/WindowsExploits](https://github.com/abatchy17/WindowsExploits)
    - [https://github.com/SecWiki/windows-kernel-exploits](https://github.com/SecWiki/windows-kernel-exploits)
- [ ]  Use Google to search for kernel exploits, if the scripts listed above don't work
- [ ]  Use searchsploit to search for kernel exploits
- [ ]  check env vars

    ```powershell
    dir env: # to show the environment variables and their paths
    Get-ChildItem Env: | ft Key,Value # to display the values of the environment variables
    ```

- [ ]  Search for passwords in Powershell history

    ```powershell
    # prints the pwoershell history 
    type C:\Users\<USERNAME>\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
    type $env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
    cat (Get-PSReadlineOption).HistorySavePath
    cat (Get-PSReadlineOption).HistorySavePath | sls passw
    ```

- [ ]  Check internet settings

    ```powershell
    reg query "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings"
    reg query "HKLM\Software\Microsoft\Windows\CurrentVersion\Internet Settings"
    ```

- [ ]  Drives

    ```powershell
    # Lists all the disks present
    wmic logicaldisk get caption,description,providername
    ```

- [ ]  Check for WSUS exploit

    ```powershell
    # checks if the system uses a non-WSL WSUS update
    reg query HKLM\Software\Policies\Microsoft\Windows\WindowsUpdate /v WUServer
    ```

- [ ]  AlwaysInstallElevated (Risky)

    If these 2 registers are enabled (value is 0x1), then users of any privilege can install (execute) ***.msi** files as NT AUTHORITY\SYSTEM.

    ```powershell
    reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
    reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
    ```

## [Logging/AV enumeration](notion://www.notion.so/windows/windows-local-privilege-escalation#enumeration)

- [ ]  Check **[Audit](notion://www.notion.so/windows/windows-local-privilege-escalation#audit-settings)** and **[WEF](notion://www.notion.so/windows/windows-local-privilege-escalation#wef)** settings
- [ ]  Check **[LAPS](notion://www.notion.so/windows/windows-local-privilege-escalation#laps)**
- [ ]  Check if **[WDigest](notion://www.notion.so/windows/windows-local-privilege-escalation#wdigest)** is active
- [ ]  **[LSA Protection](notion://www.notion.so/windows/windows-local-privilege-escalation#lsa-protection)**?
- [ ]  **[Credentials Guard](notion://www.notion.so/windows/windows-local-privilege-escalation#credentials-guard)**[?](notion://www.notion.so/windows/windows-local-privilege-escalation#cached-credentials)
- [ ]  **[Cached Credentials](notion://www.notion.so/windows/windows-local-privilege-escalation#cached-credentials)**?
- [ ]  Check if any **[AV](notion://www.notion.so/windows/windows-local-privilege-escalation#av)**
- [ ]  **[AppLocker Policy](notion://www.notion.so/windows/windows-local-privilege-escalation#applocker-policy)**?
- [ ]  **[UAC](notion://www.notion.so/windows/windows-local-privilege-escalation#uac)**?

## **[User Privileges](notion://www.notion.so/windows/windows-local-privilege-escalation#users-and-groups)**

- [ ]  Check **[current** user **privileges**](notion://www.notion.so/windows/windows-local-privilege-escalation#users-and-groups)
- [ ]  Are you **[member of any privileged group](notion://www.notion.so/windows/windows-local-privilege-escalation#privileged-groups)**?
- [ ]  Check if you have [any of these tokens enabled](notion://www.notion.so/windows/windows-local-privilege-escalation#token-manipulation): **SeImpersonatePrivilege, SeAssignPrimaryPrivilege, SeTcbPrivilege, SeBackupPrivilege, SeRestorePrivilege, SeCreateTokenPrivilege, SeLoadDriverPrivilege, SeTakeOwnershipPrivilege, SeDebugPrivilege** ?
- [ ]  **[Users Sessions](notion://www.notion.so/windows/windows-local-privilege-escalation#logged-users-sessions)**?
- [ ]  Check [**users homes**](notion://www.notion.so/windows/windows-local-privilege-escalation#home-folders) (access?)
- [ ]  Check **[Password Policy](notion://www.notion.so/windows/windows-local-privilege-escalation#password-policy)**
- [ ]  What is [**inside the Clipboard**](notion://www.notion.so/windows/windows-local-privilege-escalation#get-the-content-of-the-clipboard)?

## [Network](notion://www.notion.so/windows/windows-local-privilege-escalation#network)

- [ ]  Check **current [network** **information**](notion://www.notion.so/windows/windows-local-privilege-escalation#network)
- [ ]  Check **hidden local services** restricted to the outside

## [Running Processes](notion://www.notion.so/windows/windows-local-privilege-escalation#running-processes)

- [ ]  Processes binaries **[file and folders permissions](notion://www.notion.so/windows/windows-local-privilege-escalation#file-and-folder-permissions)**
- [ ]  **[Memory Password mining](notion://www.notion.so/windows/windows-local-privilege-escalation#memory-password-mining)**
- [ ]  **[Insecure GUI apps](notion://www.notion.so/windows/windows-local-privilege-escalation#insecure-gui-apps)**

## [Services](notion://www.notion.so/windows/windows-local-privilege-escalation#services)

- [ ]  [Can you **modify any service**?](notion://www.notion.so/windows/windows-local-privilege-escalation#permissions)
- [ ]  [Can you **modify** the **binary** that is **executed** by any **service**?](notion://www.notion.so/windows/windows-local-privilege-escalation#modify-service-binary-path)
- [ ]  [Can you **modify** the **registry** of any **service**?](notion://www.notion.so/windows/windows-local-privilege-escalation#services-registry-permissions)
- [ ]  [Can you take advantage of any **unquoted service** binary **path**?](notion://www.notion.so/windows/windows-local-privilege-escalation#unquoted-service-paths)

## **[Applications](notion://www.notion.so/windows/windows-local-privilege-escalation#applications)**

- [ ]  **Write [permissions on installed applications](notion://www.notion.so/windows/windows-local-privilege-escalation#write-permissions)**
- [ ]  **[Startup Applications](notion://www.notion.so/windows/windows-local-privilege-escalation#run-at-startup)**
- [ ]  **Vulnerable [Drivers](notion://www.notion.so/windows/windows-local-privilege-escalation#drivers)**

## [DLL Hijacking](notion://www.notion.so/windows/windows-local-privilege-escalation#path-dll-hijacking)

- [ ]  Can you **write in any folder inside PATH**?
- [ ]  Is there any known service binary that **tries to load any non-existant DLL**?
- [ ]  Can you **write** in any **binaries folder**?

## [Network](notion://www.notion.so/windows/windows-local-privilege-escalation#network)

- [ ]  Enumerate the network(shares, interfaces, routes, neighbours...)
- [ ]  Take a special look to network services listing on local (127.0.0.1)

## [Windows Credentials](notion://www.notion.so/windows/windows-local-privilege-escalation#windows-credentials)

- [ ]  **[Winlogon](notion://www.notion.so/windows/windows-local-privilege-escalation#winlogon-credentials)** credentials
- [ ]  **[Windows Vault](notion://www.notion.so/windows/windows-local-privilege-escalation#windows-vault)** credentials that you could use?
- [ ]  Interesting **[DPAPI credentials](notion://www.notion.so/windows/windows-local-privilege-escalation#dpapi)**?
- [ ]  Passwords of saved **[Wifi networks](notion://www.notion.so/windows/windows-local-privilege-escalation#wifi)**?
- [ ]  Interesting info in **[saved RDP Connections](notion://www.notion.so/windows/windows-local-privilege-escalation#saved-rdp-connections)**?
- [ ]  Passwords in **[recently run commands](notion://www.notion.so/windows/windows-local-privilege-escalation#recently-run-commands)**?
- [ ]  **[Remote Desktop Credentials Manager](notion://www.notion.so/windows/windows-local-privilege-escalation#remote-desktop-credential-manager)** passwords?
- [ ]  **[AppCmd.exe** exists](notion://www.notion.so/windows/windows-local-privilege-escalation#appcmd-exe)? Credentials?
- [ ]  **[SCClient.exe](notion://www.notion.so/windows/windows-local-privilege-escalation#scclient-sccm)**? DLL Side Loading?

## [Files and Registry (Credentials)](notion://www.notion.so/windows/windows-local-privilege-escalation#files-and-registry-credentials)

- [ ]  **Putty: [Creds](notion://www.notion.so/windows/windows-local-privilege-escalation#putty-creds) and [SSH host keys](notion://www.notion.so/windows/windows-local-privilege-escalation#putty-ssh-host-keys)**
- [ ]  **[SSH keys in registry](notion://www.notion.so/windows/windows-local-privilege-escalation#ssh-keys-in-registry)**?
- [ ]  Passwords in **[unattended files](notion://www.notion.so/windows/windows-local-privilege-escalation#unattended-files)**?
- [ ]  Any **[SAM & SYSTEM](notion://www.notion.so/windows/windows-local-privilege-escalation#sam-and-system-backups)** backup?
- [ ]  **[Cloud credentials](notion://www.notion.so/windows/windows-local-privilege-escalation#cloud-credentials)**?
- [ ]  **[McAfee SiteList.xml](notion://www.notion.so/windows/windows-local-privilege-escalation#mcafee-sitelist-xml)** file?
- [ ]  **[Cached GPP Password](notion://www.notion.so/windows/windows-local-privilege-escalation#cached-gpp-pasword)**?
- [ ]  Password in **[IIS Web config file](notion://www.notion.so/windows/windows-local-privilege-escalation#iis-web-config)**?
- [ ]  Interesting info in **[web** **logs**](notion://www.notion.so/windows/windows-local-privilege-escalation#logs)?
- [ ]  Do you want to **[ask for credentials](notion://www.notion.so/windows/windows-local-privilege-escalation#ask-for-credentials)** to the user?
- [ ]  Interesting **[files inside the Recycle Bin](notion://www.notion.so/windows/windows-local-privilege-escalation#credentials-in-the-recyclebin)**?
- [ ]  Other **[registry containing credentials](notion://www.notion.so/windows/windows-local-privilege-escalation#inside-the-registry)**?
- [ ]  Inside **[Browser data](notion://www.notion.so/windows/windows-local-privilege-escalation#browsers-history)** (dbs, history, bookmarks....)?
- [ ]  **[Generic password search](notion://www.notion.so/windows/windows-local-privilege-escalation#generic-password-search-in-files-and-registry)** in files and registry
- [ ]  **[Tools](notion://www.notion.so/windows/windows-local-privilege-escalation#tools-that-search-for-passwords)** to automatically search for passwords

## [Leaked Handlers](notion://www.notion.so/windows/windows-local-privilege-escalation#leaked-handlers)

- [ ]  Have you access to any handler of a process run by administrator?

## [Pipe Client Impersonation](notion://www.notion.so/windows/windows-local-privilege-escalation#named-pipe-client-impersonation)

- [ ]  Check if you can abuse it