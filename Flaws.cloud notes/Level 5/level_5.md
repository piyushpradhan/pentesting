# Level 5
![[Pasted image 20220409142147.png]]
169.254.169.254 -> IP address mapped to meta-data
![[Pasted image 20220409143636.png]]
```
{
  "Code" : "Success",
  "LastUpdated" : "2022-04-09T18:31:19Z",
  "Type" : "AWS-HMAC",
  "AccessKeyId" : "ASIA6GG7PSQGQ2LTPIQG",
  "SecretAccessKey" : "VVpBq/o3dwELw7L2Hu8XBWQ59EhUwYtE04xXSAuI",
  "Token" : "IQoJb3JpZ2luX2VjEFsaCXVzLXdlc3QtMiJIMEYCIQCEzx1HsBMx8T0Lhs70nsJNgKMeqpFPuB1bQjNMxqjfnQIhAOCHJwMDJyqghd7JnzxEFXK8veK1Uvkwc3vJckmwVdg3KoMECPT//////////wEQAhoMOTc1NDI2MjYyMDI5IgwQ+qX/h+EARexTnKcq1wOwZHh74gazQvwqJQHg6ljc4g3bYjLp8vnpBMOttPhYkwYmfJqL3fsuKu5yRFCr4cMeS/J3M+AJw5ipVXf8Dhp2DmtmwaKaxnAfgm15jNldgUprLqXitzpWGL/GHzBsp3oadesWJiPb6/zgAbyT02vqnd+vtXMFebIcfkem3yNibawGcFXYBoOmCxWI7ijy8LFUEeD8iSWNhnDihWx4epZGHAgcAAkBpK+HVZ9fAZqNgvjx1hrbuYNyXAhAIvfcy8QDaYlaALFEPoTJqJSt4iApdFWgWQpcddQdmFmulHUQs5L0HuPYo2LfR81qkTzQDXq6cFxxfaDVGET3KAeD2lNuQ45wASmLlDCLempGPxwh7SkNc39PCHP4wwpmulQzrUaseSFWZWy1pwJMdzjQAcU24CuCKsCtzBI5D4cHc5Fg+NJ+DKzgYpSOHCGUQ8TRmxqyLiR0a5ttakFzdimNwMfkLLZh/mJLR/CC1QS0x+oc+5S/Iqz9uEQzw1+CAwmaf8SaxAuC1SI2FT7ZS0oQslSgc7oRcaBp2DhFlXlqcfTUJi03Cz69wUgSZHmT/035m3dNldeXjeOFOt0Z6SZwr+wUOClze9/q7P+SD25NRH1SpLU7W9qYb8ww16HHkgY6pAE3AMcu/yCU8Zd+lU+Ic1tNahxscNrYAeSGCWCuVXDVAqCW0KFteC3BvEIRcLVyXxa672TWJPcNjNbjnnAqDO64DC/LDEDnnRcWIFJrpIbVYsGVb4VJdl+/FYdZqUoroHE7yWkxrLNFvDVHy/u0TWm8dqWo7bBcM2Uko/X0xlNGB1tap0M3SxNKUCVqJAOaBaNP98CaNJjZrPq2UnWaeuIyA6Lxtg==",
  "Expiration" : "2022-04-10T00:37:00Z"
}
```
Store these creds on ~/.aws/credentials (aws_session_token)
Then list the level6 bucket found after listing scott_flaws' buckets 
```
  "LastUpdated" : "2022-04-11T04:20:38Z",
  "Type" : "AWS-HMAC",
  "AccessKeyId" : "ASIA6GG7PSQG5TOD6EDL",
  "SecretAccessKey" : "JduDgfiAvwWwrXICMVwbuQpW5Ue/ZijQI1WNGzBL",
  "Token" : "IQoJb3JpZ2luX2VjEH0aCXVzLXdlc3QtMiJHMEUCIC+/XS8GTLEBkNbklMpmy3GozEtXJXfad2UvAczC0ewtAiEAtejdSx2RSVJjzb9x67AKG07muq/JpkCE040wHDPBUvIq+gMIJRACGgw5NzU0MjYyNjIwMjkiDEfyxICHACTSwbMxcyrXA1ka6XT14z0H3fkILkmn5Q0v73qN2WHxq9c34Oi3tbZNbfcvMrRdrBPwTefv4cM7VvDTx+kFiKRVQIe+kRAihhj1w0uhPB63JviZPviXihW9ux70L01wUHPev5H/Xb3DxkTBV8GjwSLFX+CkSiZqlRI+8c89W79quT0XW4hj75SzCGs4naIeA85XyBgvJ6wwqls7DK+0by0fashvFxdl9wEhOlYUSXQYjjAMHMypBg7bsOFk6tyPy8eyTiIGVQej+cT8z3LdJlV754uRqu4UX16MHpYZCsbNsrd292VfIomVMYT+Dn31xUv/reldUf2M2C73/JALg9GTWG+Owh31vtjuUsd4v6Yvmqaoqt2ZHVO1tJJTteYpVykirBxydqPudVjkvMqzX1+PB0OjL9KNH7sjEaeAeRbAG2v8EcuodKMDsOOPRGVERL0fCqOIr7SWGGOxMK19BvveYfe4ho8Cl5rwghB4lly7z05PeMIlSCTzVT3RaVCRj9U0n5pkNHfWgJe9Xym622+CSdL+5kywnjXvhcMeU7NZCriZJpwZOBt+rvu7H2uvTLVwUJv6DhSU3NOLhjfEqJX13VTa3XMr+8nSwCPP4kWWPqBvtJXMDMSixgIzxtqkMDDJ2c6SBjqlARkYGB4aMCv2SuzcmlN8UxdC2q0OY14SWZO6OD0Tp1g46a6WLJ3nMiEP+a2+HgCCVIQIOQb69t9zvdeHIGxCTnIN9g+pNlEfX+naGrxiP6r7uaFw9ZbuaOpkP8NDM4omUO9Osjv7d5sGt2H1prWZTK4mdXWRYEyqnX+viBgiY6bfYmIng1TOaxfQeXnFl01rbsX37lQPl2nzwDr7pTPgEKCpIIbaQg==",
  "Expiration" : "2022-04-11T10:31:35Z"
}
```

Store these creds on ~/.aws/credentials (aws_session_token)
Then list the level6 bucket after listing scott_flaws' buckets 
Found the desired endpoint 
```bash
kali:level_6/ $ aws s3 --profile level6_flaws ls level6-cc4c404a8a8b876167f5e70a7d8c9880.flaws.cloud                                    [1:19:18]
                           PRE ddcc78ff/
2017-02-26 21:11:07        871 index.html
```

### Note: 
169.254.169.254 is a magic IP address which is used by AWS, Azure, Google, DigitalOcean to let the cloud providers get the necessary meta-data resources about themselves
- Google has certain constraints on the access such as requiring it to use `Metadata-Flavor: Google` as an HTTP header and refusing requests with `X-Forwaded-For` header.
- AWS has recently creaded a new IDMSv2 that requires special headers, a challenge and response and other protections (But a lot of accounts have not enforced it)
### Mitigation: 
Ensure applications don't allow access to 169.254.169.254 or any local private IP ranges. 
Ensure that IAM roles are restricted as much as possible.
