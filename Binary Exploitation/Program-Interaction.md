# Program Interaction

## Binary Files 
#### ELF File format 
- ELF is a binary file format
- Contains the program and its data. 
- Describes how the program should be loaded (program/segment headers). 
- Contains metadata describing program components (secion headers). 

#### ELF Program Headers 
- These headers define segments, the parts of an ELF file that are loaded when a binary file is executed. 
- Important Entry types: 
	1. **INTERP**: defines the library should be used to load this ELF into memory. 
	2. **LOAD**: defined a part of the file that should be loaded into memory 

##### ELF Headers
![](Pasted%20image%2020211203222401.png)
- The Magic bytes when decoded to ASCII spell "ELF"
- Entry point is defined (0x10e0)
- The program execution will begin when the program reaches 0x10e0 (the entry point)

##### ELF Program Headers
![](Pasted%20image%2020211203223046.png)
- *Offset Filesize* defines from where to load the program 
- *VirtAddr MemSize* defined how much will be loaded into the memory

#### ELF Section Headers
- It has a lot of semantic information and not very important for the loading headers
- Sometimes are skipped, these are needed during the linktime but aren't needed on runtime.  
- These define what the segments have inside them. 
- Important sections: 
	1. .text -> the executable code of your program 
	2. .plt and .got -> used to resolve and dispatch library calls 
	3. .data -> used for pre-initialized global writable data 
	4. .rodata -> used for global read-only data 
	5. .bss -> used for unitialized global writable data 

#### ELF Headers' Definitions
-   e_ident: Array of 16 bytes containing identification flags about the file, which serve to decode and interpret the file’s contents. Examples of these identification flags include:
    -   EI_MAG0-3: ELF magic
    -   EI_CLASS: File class.
    -   EI_DATA: File’s data encoding.
    -   EI_VERSION: File’s version.
    -   EI_OSABI: OS/ABI identification.
    -   EI_ABIVERSION: ABI version
    -   EI_PAD: Start of padding bytes.
    -   EI_NIDENT: Size of ei_ident.

-   e_type: Type of executable.
-   e_machine: File’s architecture.
-   e_version: Object file version.
-   e_entry:  Entry point of application.
-   e_phoff: File offset of the Program Header Table.
-   e_shoff: File offset of the Section Header Table.
-   e_flags: Processor-specific flags associated with the file.
-   e_ehsize: ELF header size.
-   e_phentsize: Program Header entry size in Program Header Table.
-   e_phnum: Number of Program Headers.
-   e_shentsize: Section Header entry size in Section Header Table.
-   e_shnum: Number of Section Headers.
-   e_shstrndx: index in Section Header Table Denoting Section dedicated to Hold Section names.

#### Sections' definitions
-   sh_name: index of section name in section header string table.
-   sh_type: section type.
-   sh_flags: section attributes.
-   sh_addr: virtual address of section.
-   sh_offset: section offset in disk.
-   sh_size: section size.
-   sh_link: section link index.
-   sh_Info: Section extra information.
-   sh_addralign: section alignment.
-   sh_entsize: size of entries contained in section.

Some common sections are the following:

-   .text: code.
-   .data: initialised data.
-   .rodata: initialised read-only data.
-   .bss: uninitialized data.
-   .plt: PLT (Procedure Linkage Table) (IAT equivalent).
-   .got: GOT entries dedicated to dynamically linked global variables.
-   .got.plt: GOT entries dedicated to dynamically linked functions.
-   .symtab: global symbol table.
-   .dynamic: Holds all needed information for dynamic linking.
-   .dynsym: symbol tables dedicated to dynamically linked symbols.
-   .strtab: string table of .symtab section.
-   .dynstr: string table of .dynsym section.
-   .interp: RTLD embedded string.
-   .rel.dyn: global variable relocation table.
-   .rel.plt: function relocation table.

#### Segments (Program Headers)
- Break down the structure of an ELF binary into suitable chunks to prepare the executable to be loaded into memory. 
- These are not needed on linktime 
    -   p_type: Segment type.
    -   p_flags: Segment attributes.
    -   p_offset: File offset of segment.
    -   p_vaddr: Virtual address of segment.
    -   p_paddr: Physical address of segment.
    -   p_filesz: Size of segment on disk.
    -   p_memsz: Size of segment in memory.
    -   P_align: segment alignment in memory.

- There are a wide range of segment types. Some of common types are the following
    -   PT_NULL: unassigned segment (usually first entry of Program Header Table).
    -   PT_LOAD: Loadable segment.
    -   PT_INTERP: Segment holding .interp section.
    -   PT_TLS: Thread Local Storage segment (Common in statically linked binaries).
    -   PT_DYNAMIC: Holding .dynamic section.


## Linux Process Loading

